!function(e){"use strict";var r,c=window.angular,l={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/api/session",cache:!1};var s=["ngSession","$q",function(e,n){if(c.isDate(r)){if("boolean"==typeof cfg.cache&&l.cache)return n.resolve();if(c.isNumber(l.cache)&&r.valueOf()+l.cache<Date.now())return n.resolve()}return e.update()}];var n={configure:function(e){c.isString(e.updateUrl)&&(l.updateUrl=e.updateUrl),c.isString(e.signInUrl)&&(l.signInUrl=e.signInUrl),c.isString(e.signOutUrl)&&(l.signOutUrl=e.signOutUrl),(c.isNumber(e.cache)||"boolean"==typeof e.cache)&&(l.cache=e.cache)},$get:["$rootScope","$http","$q",function(s,t,i){function u(e,n){return n||(n=i.defer()),t.get(l.updateUrl,e).then(function(e,n){s.session.user=n.data,r=new Date,e.resolve(n)}.bind(null,n)).catch(n.reject),n.promise}function o(e){var n=s.session;return n?e&&n.user?n.user[e]:n.user:null}return s.session={},{hasRole:function(e,n){var r=o("roles"),s=0;if(!r||!r.length)return!1;c.isString(r)&&(r=[r]),c.isString(e)&&(e=[e]);for(var t=0,i=e.length;t<i;t++)-1<r.indexOf(e[t])&&s++;return n?s===e.length:!!s},signOut:function(e,n){var r=i.defer();return t.post(l.signOutUrl,e,n).then(function(e,n){s.session.user=null,e.resolve(n)}.bind(null,r)).catch(r.reject),r.promise},signIn:function(e,n){var r=i.defer();return s.session.user=null,t.post(l.signInUrl,e,n).then(function(e){return u(null,e)}.bind(null,r)).catch(r.reject),r.promise},reload:function(e,n,r){return r||(r=i.defer()),t.put(l.updateUrl,e,n).then(u.bind(null,n,r)).catch(r.reject),r.promise},update:u,user:o,get:function(e){return s.session[e]},set:function(e,n){s.session[e]=n},del:function(e){delete s.session[e]}}}]};c.module("ngSession",[]).provider("ngSession",function(){return n}).run(["$route",function(e){for(var n in e.routes){var r=e.routes[n];c.isObject(r.resolve)||(r.resolve={}),r.resolve._session=s}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwidXBkYXRlZEF0IiwibmciLCJhbmd1bGFyIiwiZGVmYXVsdHMiLCJzaWduT3V0VXJsIiwic2lnbkluVXJsIiwidXBkYXRlVXJsIiwiY2FjaGUiLCJzZXNzaW9uUmVzb2x2ZURlZiIsIiRzZXNzaW9uIiwiJHEiLCJpc0RhdGUiLCJjZmciLCJyZXNvbHZlIiwiaXNOdW1iZXIiLCJ2YWx1ZU9mIiwiRGF0ZSIsIm5vdyIsInVwZGF0ZSIsIm5nU2Vzc2lvblByb3ZpZGVyRGVmIiwiY29uZmlndXJlIiwiaXNTdHJpbmciLCIkZ2V0IiwiJHJvb3RTY29wZSIsIiRodHRwIiwiY29uZmlnIiwiZGVmZXJyZWQiLCJkZWZlciIsImdldCIsInRoZW4iLCJyZXMiLCJzZXNzaW9uIiwidXNlciIsImRhdGEiLCJiaW5kIiwiY2F0Y2giLCJyZWplY3QiLCJwcm9taXNlIiwicHJvcCIsImhhc1JvbGUiLCJyb2xlcyIsImFsbCIsImFjdHVhbCIsIm1hdGNoZXMiLCJsZW5ndGgiLCJpIiwibCIsImluZGV4T2YiLCJzaWduT3V0IiwicG9zdCIsInNpZ25JbiIsInJlbG9hZCIsInB1dCIsInNldCIsInZhbHVlIiwiZGVsIiwibW9kdWxlIiwicHJvdmlkZXIiLCJydW4iLCIkcm91dGUiLCJwYXRoIiwicm91dGVzIiwicm91dGUiLCJpc09iamVjdCIsIl9zZXNzaW9uIl0sIm1hcHBpbmdzIjoiQ0FTQSxTQUFVQSxHQUNSLGFBRUEsSUFVSUMsRUFWQUMsRUE0WkhGLE9BNVplRyxRQUdaQyxFQUFXLENBQ2JDLFdBQVksc0JBQ1pDLFVBQVcscUJBQ1hDLFVBQVcsZUFDWEMsT0FBTyxHQXlUVCxJQUFJQyxFQUFvQixDQUFDLFlBQWEsS0FmdEMsU0FBMEJDLEVBQVVDLEdBQ2xDLEdBQUlULEVBQUdVLE9BQU9YLEdBQVksQ0FDeEIsR0FBd0Isa0JBQWJZLElBQUlMLE9BQXNCSixFQUFTSSxNQUM1QyxPQUFPRyxFQUFHRyxVQUdaLEdB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QVFnQixHQXVDM0JDLElBZEYsU0FBYWpCLFVBQ0pmLEVBQVdRLFFBQVFPLFFBNEg5QnJDLEVBQUd1RCxPQUFPLFlBQWEsSUFHcEJDLFNBQVMsWUFSWixXQUNFLE9BQU90QyxJQVVOdUMsSUFBSSxDQUFDLFNBcEZSLFNBQXdCQyxHQUN0QixJQUFLLElBQUlDLEtBQVFELEVBQU9FLE9BQVEsQ0FDOUIsSUFBSUMsRUFBUUgsRUFBT0UsT0FBT0QsR0FFckIzRCxFQUFHOEQsU0FBU0QsRUFBTWpELFdBQ3JCaUQsRUFBTWpELFFBQVUsSUFHbEJpRCxFQUFNakQsUUFBUW1ELFNBQVd4RCxNQWxWL0IiLCJmaWxlIjoibmctc2Vzc2lvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogbmdTZXNzaW9uXG4gKlxuICogQGRlc2NyaXB0aW9uIFNlc3Npb24gaGFuZGxlciBtb2R1bGUgZm9yIEFuZ3VsYXJKUy5cbiAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gKiBAYXV0aG9yIEZpbmFsIERldmVsb3BtZW50IFN0dWRpb1xuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuKGZ1bmN0aW9uKHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG5nID0gd2luZG93LmFuZ3VsYXI7XG5cbiAgLyogRGVmYXVsdCBjb25maWd1cmF0aW9uICovXG4gIHZhciBkZWZhdWx0cyA9IHtcbiAgICBzaWduT3V0VXJsOiAnL2FwaS91c2Vycy9zaWduLW91dCcsXG4gICAgc2lnbkluVXJsOiAnL2FwaS91c2Vycy9zaWduLWluJyxcbiAgICB1cGRhdGVVcmw6ICcvYXBpL3Nlc3Npb24nLFxuICAgIGNhY2hlOiBmYWxzZVxuICB9O1xuXG4gIHZhciB1cGRhdGVkQXQ7XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBzZXJ2aWNlIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uU2VydmljZUZuKCRyb290U2NvcGUsICRodHRwLCAkcSkge1xuICAgICRyb290U2NvcGUuc2Vzc2lvbiA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogQG1vZHVsZSBuZ1Nlc3Npb25cbiAgICAgKiBAZGVzY3JpcHRpb24gbmdTZXNzaW9uIFNlcnZpY2VcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIFNlc3Npb24gdXBkYXRlIHN1Y2Nlc3NmdWwuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MoZGVmZXJyZWQsIHJlcykge1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uLnVzZXIgPSByZXMuZGF0YTtcblxuICAgICAgdXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9uIFNpZ24gSW4gc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TaW5nSW5TdWNjZXNzKGRlZmVycmVkKSB7XG4gICAgICByZXR1cm4gdXBkYXRlKG51bGwsIGRlZmVycmVkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbiBTaWduIE91dCBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNpbmdPdXRTdWNjZXNzKGRlZmVycmVkLCByZXMpIHtcbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gbnVsbDtcblxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpZ25zIGEgdXNlciBpbi5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIGBQT1NUYCB0byB0aGUgYGRlZmF1bHRzLnNpZ25PdXRVcmxgIHBhdGggYW5kIHBlcmZvcm0gYW5cbiAgICAgKiBgdXBkYXRlYCBpZiBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBpbi5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24uc2lnbkluKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2lnbkluKGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgLyogUmVtb3ZlIHByZXZpb3VzIHVzZXIgb2JqZWN0ICovXG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IG51bGw7XG5cbiAgICAgICRodHRwXG4gICAgICAgIC5wb3N0KGRlZmF1bHRzLnNpZ25JblVybCwgZGF0YSwgY29uZmlnKVxuICAgICAgICAudGhlbihvblNpbmdJblN1Y2Nlc3MuYmluZChudWxsLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgb3V0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgUE9TVCB0byB0aGUgYGRlZmF1bHRzLnNpZ25PdXRVcmxgIHBhdGggYW5kIGRlbGV0ZSB0aGVcbiAgICAgKiB1c2VyIG9iamVjdCBvbiBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBvdXQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnNpZ25PdXQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaWduT3V0KGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHBcbiAgICAgICAgLnBvc3QoZGVmYXVsdHMuc2lnbk91dFVybCwgZGF0YSwgY29uZmlnKVxuICAgICAgICAudGhlbihvblNpbmdPdXRTdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpKVxuICAgICAgICAuY2F0Y2goZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVsb2FkcyB0aGUgc2Vzc2lvbiB1c2VyIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIFBVVCB0byB0aGUgYGRlZmF1bHRzLnVwZGF0ZVVybGAgcGF0aCBhbmQgdGhlbiBhXG4gICAgICogY29uc2VjdWVudCBzZXNzaW9uIGB1cGRhdGVgLlxuICAgICAqXG4gICAgICogVGhlIHNlcnZlciBzaG91bGQgaGFuZGxlIHRoZSBPVXQgcmVxdWVzdCBhcyBhIHJlbG9hZCByZXF1ZXN0IGFuZCBmZXRjaFxuICAgICAqIHVwZGF0ZWQgc2Vzc2lvbiBkYXRhLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3IgdGhlIHJlbG9hZC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge1Byb21pc2V9IGRlZmVycmVkIE9wdGlvbmFsIGRlZmVycmVkIHByb21pc2Ugb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5yZWxvYWQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWxvYWQoZGF0YSwgY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJlbG9hZHMgY3VycmVudCBzZXNzaW9uICovXG4gICAgICAkaHR0cFxuICAgICAgICAucHV0KGRlZmF1bHRzLnVwZGF0ZVVybCwgZGF0YSwgY29uZmlnKVxuICAgICAgICAudGhlbih1cGRhdGUuYmluZChudWxsLCBjb25maWcsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHNlc3Npb24gdXNlciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBHRVQgdG8gdGhlIGBkZWZhdWx0cy51cGRhdGVVcmxgIHBhdGggYW5kIHNldCB0aGVcbiAgICAgKiBzZXNzaW9uJ3MgdXNlciBvYmplY3Qgb24gc3VjY2VzcyB3aXRoIHRoZSByZXF1ZXN0J3MgYHJlcy5kYXRhYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBjb25maWd1cmF0aW9uLlxuICAgICAqIEBwYXJhbSB7UHJvbWlzZX0gZGVmZXJyZWQgT3B0aW9uYWwgZGVmZXJyZWQgcHJvbWlzZSBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnVwZGF0ZSgpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1cGRhdGUoY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJldHJpZXZlIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHBcbiAgICAgICAgLmdldChkZWZhdWx0cy51cGRhdGVVcmwsIGNvbmZpZylcbiAgICAgICAgLnRoZW4ob25TZXNzaW9uVXBkYXRlU3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhIHVzZXIgZGF0YSB2YWx1ZSBieSBwcm9wZXJ0eSBuYW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUgdG8gcmV0cmlldmUuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlIG9yIHRoZSB1c2VyIG9iamVjdCBpZiBub1xuICAgICAqIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSBuZ1Nlc3Npb24udXNlcignbmFtZScpOyAvLyA9PiAnSm9obiBTbWl0aCdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1c2VyKHByb3ApIHtcbiAgICAgIHZhciBzZXNzaW9uID0gJHJvb3RTY29wZS5zZXNzaW9uO1xuXG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wICYmIHNlc3Npb24udXNlcikge1xuICAgICAgICByZXR1cm4gc2Vzc2lvbi51c2VyW3Byb3BdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2Vzc2lvbi51c2VyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBhbnkgb3IgYWxsIG9mIHRoZSBwcm92aWRlZCByb2xlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7KFN0cmluZ3xTdHJpbmdbXSl9IHJvbGVzIFRoZSByZXF1aXJlZCByb2xlcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGFsbCBJZiBhbGwgdGhlIHByb3ZpZGVkIHJvbGVzIGFyZSByZXF1aXJlZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKCdST0xFLkFETUlOJyk7IC8vID0+IGZhbHNlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGUoJ1JPTEUuVVNFUicpOyAvLyA9PiB0cnVlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGUoWydST0xFLkFETUlOJywgJ1JPTEUuVVNFUiddKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKFsnUk9MRS5BRE1JTicsICdST0xFLlVTRVInXSwgdHJ1ZSk7IC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgYWxsKSB7XG4gICAgICB2YXIgYWN0dWFsID0gdXNlcigncm9sZXMnKTtcbiAgICAgIHZhciBtYXRjaGVzID0gMDtcblxuICAgICAgaWYgKCFhY3R1YWwgfHwgIWFjdHVhbC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAobmcuaXNTdHJpbmcoYWN0dWFsKSkge1xuICAgICAgICBhY3R1YWwgPSBbYWN0dWFsXTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKHJvbGVzKSkge1xuICAgICAgICByb2xlcyA9IFtyb2xlc107XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhY3R1YWwuaW5kZXhPZihyb2xlc1tpXSkgPiAtMSkge1xuICAgICAgICAgIG1hdGNoZXMrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYWxsKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzID09PSByb2xlcy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhIW1hdGNoZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhIHZhbHVlIGluIHRoZSBzZXNzaW9uIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBUaGUgcHJvcGVydHkgdmFsdWUgdG8gc2V0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnNldCgndGVzdCcsICdUZXN0IFZhbHVlJyk7XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0KHByb3AsIHZhbHVlKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW5zIGEgdmFsdWUgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBvYnRhaW4uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLmdldCgndGVzdCcpOyAvLyA9PiAnVGVzdCBWYWx1ZSdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXQocHJvcCkge1xuICAgICAgcmV0dXJuICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgcHJvcGVydHkgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmRlbCgndGVzdCcpO1xuICAgICAqIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gbnVsbFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbChwcm9wKSB7XG4gICAgICBkZWxldGUgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdO1xuICAgIH1cblxuICAgIC8qIFNlc3Npb24gc2VydmljZSBkZWZpbml0aW9uICovXG4gICAgdmFyIG5nU2Vzc2lvblNlcnZpY2VEZWYgPSB7XG4gICAgICBoYXNSb2xlOiBoYXNSb2xlLFxuICAgICAgc2lnbk91dDogc2lnbk91dCxcbiAgICAgIHNpZ25Jbjogc2lnbkluLFxuICAgICAgcmVsb2FkOiByZWxvYWQsXG4gICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgIHVzZXI6IHVzZXIsXG4gICAgICBnZXQ6IGdldCxcbiAgICAgIHNldDogc2V0LFxuICAgICAgZGVsOiBkZWxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5nU2Vzc2lvblNlcnZpY2VEZWY7XG4gIH1cblxuICAvKipcbiAgICogU2Vzc2lvbiByZXNvbHZlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gc2Vzc2lvblJlc29sdmVGbigkc2Vzc2lvbiwgJHEpIHtcbiAgICBpZiAobmcuaXNEYXRlKHVwZGF0ZWRBdCkpIHtcbiAgICAgIGlmICh0eXBlb2YgY2ZnLmNhY2hlID09ICdib29sZWFuJyAmJiBkZWZhdWx0cy5jYWNoZSkge1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAobmcuaXNOdW1iZXIoZGVmYXVsdHMuY2FjaGUpICYmIHVwZGF0ZWRBdC52YWx1ZU9mKCkgKyBkZWZhdWx0cy5jYWNoZSA8IERhdGUubm93KCkpIHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gJHNlc3Npb24udXBkYXRlKCk7XG4gIH1cblxuICAvKiBTZXNzaW9uIHJlc29sdmUgZGVmaW5pdGlvbiAqL1xuICB2YXIgc2Vzc2lvblJlc29sdmVEZWYgPSBbJ25nU2Vzc2lvbicsICckcScsIHNlc3Npb25SZXNvbHZlRm5dO1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcnVuIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uUnVuRm4oJHJvdXRlKSB7XG4gICAgZm9yICh2YXIgcGF0aCBpbiAkcm91dGUucm91dGVzKSB7XG4gICAgICB2YXIgcm91dGUgPSAkcm91dGUucm91dGVzW3BhdGhdO1xuXG4gICAgICBpZiAoIW5nLmlzT2JqZWN0KHJvdXRlLnJlc29sdmUpKSB7XG4gICAgICAgIHJvdXRlLnJlc29sdmUgPSB7fTtcbiAgICAgIH1cblxuICAgICAgcm91dGUucmVzb2x2ZS5fc2Vzc2lvbiA9IHNlc3Npb25SZXNvbHZlRGVmO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbW9kdWxlIG5nU2Vzc2lvblByb3ZpZGVyXG4gICAqIEBkZXNjcmlwdGlvbiBuZ1Nlc3Npb24gUHJvdmlkZXJcbiAgICovXG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gbWV0aG9kLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy51cGRhdGVVcmwgVGhlIHNlc3Npb24gdXBkYXRlIFVSTCAoR0VUfFBVVCkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuc2lnbkluVXJsIFRoZSBzZXNzaW9uIHNpZ24gaW4gVVJMIChQT1NUKS5cbiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5zaWduT3V0VXJsIFRoZSBzZXNzaW9uIHNpZ24gb3V0IFVSTCAoUE9TVCkuXG4gICAqIEBwYXJhbSB7TnVtYmVyfEJvb2xlYW59IGNmZy5jYWNoZSBUaGUgc2Vzc2lvbiBjYWNoZSBiZWhhdmlvci4gTnVtYmVyIGlzIHRoZSBtaWxsaXNlY29uZHMgdG8gY2FjaGUgdGhlIHNlc3Npb24gZm9yLlxuICAgKiBBIGJvb2xlYW4gXCJ0cnVlXCIgd2lsbCBjYWNoZSB0aGUgc2Vzc2lvbiBmb3JldmVyLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBuZ1Nlc3Npb25Qcm92aWRlci5jb25maWd1cmUoe1xuICAgKiAgIHNpZ25PdXRVcmw6ICcvYXBpL3VzZXJzL3NpZ24tb3V0JyxcbiAgICogICBzaWduSW5Vcmw6ICcvYXBpL3VzZXJzL3NpZ24taW4nLFxuICAgKiAgIHVwZGF0ZVVybDogJy9hcGkvc2Vzc2lvbicsXG4gICAqICAgY2FjaGU6ICcxaCdcbiAgICogfSk7XG4gICAqL1xuICBmdW5jdGlvbiBjb25maWd1cmUoY2ZnKSB7XG4gICAgLyogU2V0cyBzZXNzaW9uIHVwZGF0ZSBHRVQgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy51cGRhdGVVcmwpKSB7XG4gICAgICBkZWZhdWx0cy51cGRhdGVVcmwgPSBjZmcudXBkYXRlVXJsO1xuICAgIH1cblxuICAgIC8qIFNldHMgc2lnbiBpbiBQT1NUIFVSTCAqL1xuICAgIGlmIChuZy5pc1N0cmluZyhjZmcuc2lnbkluVXJsKSkge1xuICAgICAgZGVmYXVsdHMuc2lnbkluVXJsID0gY2ZnLnNpZ25JblVybDtcbiAgICB9XG5cbiAgICAvKiBTZXRzIHNpZ24gb3V0IFBPU1QgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy5zaWduT3V0VXJsKSkge1xuICAgICAgZGVmYXVsdHMuc2lnbk91dFVybCA9IGNmZy5zaWduT3V0VXJsO1xuICAgIH1cblxuICAgIC8qIFNldHMgdGhlIGNhY2hlIGJlaGF2aW9yICovXG4gICAgaWYgKG5nLmlzTnVtYmVyKGNmZy5jYWNoZSkgfHwgdHlwZW9mIGNmZy5jYWNoZSA9PSAnYm9vbGVhbicpIHtcbiAgICAgIGRlZmF1bHRzLmNhY2hlID0gY2ZnLmNhY2hlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcHJvdmlkZXIgZGVmaW5pdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHZhciBuZ1Nlc3Npb25Qcm92aWRlckRlZiA9IHtcbiAgICBjb25maWd1cmU6IGNvbmZpZ3VyZSxcblxuICAgICRnZXQ6IFsnJHJvb3RTY29wZScsICckaHR0cCcsICckcScsIG5nU2Vzc2lvblNlcnZpY2VGbl1cbiAgfTtcblxuICAvKipcbiAgICogbmdTZXNzaW9uIHByb3ZpZGVyIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uUHJvdmlkZXJGbigpIHtcbiAgICByZXR1cm4gbmdTZXNzaW9uUHJvdmlkZXJEZWY7XG4gIH1cblxuICAvKiBEZWZpbmUgQW5ndWxhckpTIG1vZHVsZSAqL1xuICBuZy5tb2R1bGUoJ25nU2Vzc2lvbicsIFtdKVxuXG4gICAgLyogRGVmaW5lIHNlcnZpY2UgcHJvdmlkZXIgKi9cbiAgICAucHJvdmlkZXIoJ25nU2Vzc2lvbicsIG5nU2Vzc2lvblByb3ZpZGVyRm4pXG5cbiAgICAvKiBEZWZpbmUgQW5ndWxhckpTIG1vZHVsZSBydW4gZnVuY3Rpb24gKi9cbiAgICAucnVuKFsnJHJvdXRlJywgbmdTZXNzaW9uUnVuRm5dKTtcbn0pKHdpbmRvdyk7XG4iXX0=
