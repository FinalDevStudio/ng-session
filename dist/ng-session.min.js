!function(e){"use strict";var s,l=window.angular,a={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/api/session",cache:!1};var r=["ngSession",function(e){if(console.log("Resolving session..."),l.isDate(s)){if(console.log("Updated at is date..."),"boolean"==typeof a.cache&&a.cache)return void console.log("Cache is boolean and should not update...");if(l.isNumber(a.cache)&&s.valueOf()+a.cache>Date.now())return void console.log("Cache is number and should not update...")}return console.log("Updated at is",typeof s),e.update()}];var n={configure:function(e){l.isString(e.updateUrl)&&(a.updateUrl=e.updateUrl),l.isString(e.signInUrl)&&(a.signInUrl=e.signInUrl),l.isString(e.signOutUrl)&&(a.signOutUrl=e.signOutUrl),(l.isNumber(e.cache)||"boolean"==typeof e.cache)&&(a.cache=e.cache)},$get:["$rootScope","$http","$q",function(r,t,o){function i(e,n){return n||(n=o.defer()),t.get(a.updateUrl,e).then(function(e,n){r.session.user=n.data,s=new Date,e.resolve(n)}.bind(null,n),n.reject),n.promise}function u(e){var n=r.session;return n?e&&n.user?n.user[e]:n.user:null}return r.session={},{hasRole:function(e,n){var s=u("roles"),r=0;if(!s||!s.length)return!1;l.isString(s)&&(s=[s]),l.isString(e)&&(e=[e]);for(var t=0,o=e.length;t<o;t++)-1<s.indexOf(e[t])&&r++;return n?r===e.length:!!r},signOut:function(e,n){var s=o.defer();return t.post(a.signOutUrl,e,n).then(function(e,n){r.session.user=null,e.resolve(n)}.bind(null,s),s.reject),s.promise},signIn:function(e,n){var s=o.defer();return r.session.user=null,t.post(a.signInUrl,e,n).then(function(e){return i(null,e)}.bind(null,s),s.reject),s.promise},reload:function(e,n,s){return s||(s=o.defer()),t.put(a.updateUrl,e,n).then(i.bind(null,n,s),s.reject),s.promise},update:i,user:u,get:function(e){return r.session[e]},set:function(e,n){r.session[e]=n},del:function(e){delete r.session[e]}}}]};l.module("ngSession",[]).provider("ngSession",function(){return n}).run(["$route",function(e){for(var n in e.routes){var s=e.routes[n];l.isObject(s.resolve)||(s.resolve={}),s.resolve._session=r}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwidXBkYXRlZEF0IiwibmciLCJhbmd1bGFyIiwiZGVmYXVsdHMiLCJzaWduT3V0VXJsIiwic2lnbkluVXJsIiwidXBkYXRlVXJsIiwiY2FjaGUiLCJzZXNzaW9uUmVzb2x2ZURlZiIsIiRzZXNzaW9uIiwiY29uc29sZSIsImxvZyIsImlzRGF0ZSIsImlzTnVtYmVyIiwidmFsdWVPZiIsIkRhdGUiLCJub3ciLCJ1cGRhdGUiLCJuZ1Nlc3Npb25Qcm92aWRlckRlZiIsImNvbmZpZ3VyZSIsImNmZyIsImlzU3RyaW5nIiwiJGdldCIsIiRyb290U2NvcGUiLCIkaHR0cCIsIiRxIiwiY29uZmlnIiwiZGVmZXJyZWQiLCJkZWZlciIsImdldCIsInRoZW4iLCJyZXMiLCJzZXNzaW9uIiwidXNlciIsImRhdGEiLCJyZXNvbHZlIiwiYmluZCIsInJlamVjdCIsInByb21pc2UiLCJwcm9wIiwiaGFzUm9sZSIsInJvbGVzIiwiYWxsIiwiYWN0dWFsIiwibWF0Y2hlcyIsImxlbmd0aCIsImkiLCJsIiwiaW5kZXhPZiIsInNpZ25PdXQiLCJwb3N0Iiwic2lnbkluIiwicmVsb2FkIiwicHV0Iiwic2V0IiwidmFsdWUiLCJkZWwiLCJtb2R1bGUiLCJwcm92aWRlciIsInJ1biIsIiRyb3V0ZSIsInBhdGgiLCJyb3V0ZXMiLCJyb3V0ZSIsImlzT2JqZWN0IiwiX3Nlc3Npb24iXSwibWFwcGluZ3MiOiJDQVNBLFNBQVVBLEdBQ1IsYUFFQSxJQVVJQyxFQVZBQyxFQXdaSEYsT0F4WmVHLFFBR1pDLEVBQVcsQ0FDYkMsV0FBWSxzQkFDWkMsVUFBVyxxQkFDWEMsVUFBVyxlQUNYQyxPQUFPLEdBcVRULElBQUlDLEVBQW9CLENBQUMsWUF2QnpCLFNBQTBCQyxHQUd4QixHQUZBQyxRQUFRQyxJQUFJLHdCQUVSVixFQUFHVyxPQUFPWixHQUFZLENBR3hCLEdBRkFVLFFBQVFDLElBQUkseUJBRWlCLGtCQUFsQlIsRUFBU0ksT0FB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eUIxQmUsSUF2Q0YsU0FBYWYsRUFBTWdCLEdBQ2pCaEMsRUFBV1MsUUFBUU8sR0FBUWdCLEdBdUMzQkMsSUFkRixTQUFhakIsVUFDSmhCLEVBQVdTLFFBQVFPLFFBb0k5QnRDLEVBQUd3RCxPQUFPLFlBQWEsSUFHcEJDLFNBQVMsWUFSWixXQUNFLE9BQU94QyxJQVVOeUMsSUFBSSxDQUFDLFNBcEZSLFNBQXdCQyxHQUN0QixJQUFLLElBQUlDLEtBQVFELEVBQU9FLE9BQVEsQ0FDOUIsSUFBSUMsRUFBUUgsRUFBT0UsT0FBT0QsR0FFckI1RCxFQUFHK0QsU0FBU0QsRUFBTTVCLFdBQ3JCNEIsRUFBTTVCLFFBQVUsSUFHbEI0QixFQUFNNUIsUUFBUThCLFNBQVd6RCxNQTlVL0IiLCJmaWxlIjoibmctc2Vzc2lvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogbmdTZXNzaW9uXG4gKlxuICogQGRlc2NyaXB0aW9uIFNlc3Npb24gaGFuZGxlciBtb2R1bGUgZm9yIEFuZ3VsYXJKUy5cbiAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gKiBAYXV0aG9yIEZpbmFsIERldmVsb3BtZW50IFN0dWRpb1xuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuKGZ1bmN0aW9uKHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG5nID0gd2luZG93LmFuZ3VsYXI7XG5cbiAgLyogRGVmYXVsdCBjb25maWd1cmF0aW9uICovXG4gIHZhciBkZWZhdWx0cyA9IHtcbiAgICBzaWduT3V0VXJsOiAnL2FwaS91c2Vycy9zaWduLW91dCcsXG4gICAgc2lnbkluVXJsOiAnL2FwaS91c2Vycy9zaWduLWluJyxcbiAgICB1cGRhdGVVcmw6ICcvYXBpL3Nlc3Npb24nLFxuICAgIGNhY2hlOiBmYWxzZVxuICB9O1xuXG4gIHZhciB1cGRhdGVkQXQ7XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBzZXJ2aWNlIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uU2VydmljZUZuKCRyb290U2NvcGUsICRodHRwLCAkcSkge1xuICAgICRyb290U2NvcGUuc2Vzc2lvbiA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogQG1vZHVsZSBuZ1Nlc3Npb25cbiAgICAgKiBAZGVzY3JpcHRpb24gbmdTZXNzaW9uIFNlcnZpY2VcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIFNlc3Npb24gdXBkYXRlIHN1Y2Nlc3NmdWwuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MoZGVmZXJyZWQsIHJlcykge1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uLnVzZXIgPSByZXMuZGF0YTtcblxuICAgICAgdXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9uIFNpZ24gSW4gc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TaW5nSW5TdWNjZXNzKGRlZmVycmVkKSB7XG4gICAgICByZXR1cm4gdXBkYXRlKG51bGwsIGRlZmVycmVkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbiBTaWduIE91dCBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNpbmdPdXRTdWNjZXNzKGRlZmVycmVkLCByZXMpIHtcbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gbnVsbDtcblxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpZ25zIGEgdXNlciBpbi5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIGBQT1NUYCB0byB0aGUgYGRlZmF1bHRzLnNpZ25PdXRVcmxgIHBhdGggYW5kIHBlcmZvcm0gYW5cbiAgICAgKiBgdXBkYXRlYCBpZiBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBpbi5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24uc2lnbkluKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2lnbkluKGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgLyogUmVtb3ZlIHByZXZpb3VzIHVzZXIgb2JqZWN0ICovXG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IG51bGw7XG5cbiAgICAgICRodHRwLnBvc3QoZGVmYXVsdHMuc2lnbkluVXJsLCBkYXRhLCBjb25maWcpLnRoZW4ob25TaW5nSW5TdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpLCBkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgb3V0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgUE9TVCB0byB0aGUgYGRlZmF1bHRzLnNpZ25PdXRVcmxgIHBhdGggYW5kIGRlbGV0ZSB0aGVcbiAgICAgKiB1c2VyIG9iamVjdCBvbiBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBvdXQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnNpZ25PdXQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaWduT3V0KGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAucG9zdChkZWZhdWx0cy5zaWduT3V0VXJsLCBkYXRhLCBjb25maWcpLnRoZW4ob25TaW5nT3V0U3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSwgZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVsb2FkcyB0aGUgc2Vzc2lvbiB1c2VyIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIFBVVCB0byB0aGUgYGRlZmF1bHRzLnVwZGF0ZVVybGAgcGF0aCBhbmQgdGhlbiBhXG4gICAgICogY29uc2VjdWVudCBzZXNzaW9uIGB1cGRhdGVgLlxuICAgICAqXG4gICAgICogVGhlIHNlcnZlciBzaG91bGQgaGFuZGxlIHRoZSBPVXQgcmVxdWVzdCBhcyBhIHJlbG9hZCByZXF1ZXN0IGFuZCBmZXRjaFxuICAgICAqIHVwZGF0ZWQgc2Vzc2lvbiBkYXRhLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3IgdGhlIHJlbG9hZC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge1Byb21pc2V9IGRlZmVycmVkIE9wdGlvbmFsIGRlZmVycmVkIHByb21pc2Ugb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5yZWxvYWQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWxvYWQoZGF0YSwgY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJlbG9hZHMgY3VycmVudCBzZXNzaW9uICovXG4gICAgICAkaHR0cC5wdXQoZGVmYXVsdHMudXBkYXRlVXJsLCBkYXRhLCBjb25maWcpLnRoZW4odXBkYXRlLmJpbmQobnVsbCwgY29uZmlnLCBkZWZlcnJlZCksIGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHNlc3Npb24gdXNlciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBHRVQgdG8gdGhlIGBkZWZhdWx0cy51cGRhdGVVcmxgIHBhdGggYW5kIHNldCB0aGVcbiAgICAgKiBzZXNzaW9uJ3MgdXNlciBvYmplY3Qgb24gc3VjY2VzcyB3aXRoIHRoZSByZXF1ZXN0J3MgYHJlcy5kYXRhYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBjb25maWd1cmF0aW9uLlxuICAgICAqIEBwYXJhbSB7UHJvbWlzZX0gZGVmZXJyZWQgT3B0aW9uYWwgZGVmZXJyZWQgcHJvbWlzZSBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnVwZGF0ZSgpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1cGRhdGUoY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJldHJpZXZlIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHAuZ2V0KGRlZmF1bHRzLnVwZGF0ZVVybCwgY29uZmlnKS50aGVuKG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MuYmluZChudWxsLCBkZWZlcnJlZCksIGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhIHVzZXIgZGF0YSB2YWx1ZSBieSBwcm9wZXJ0eSBuYW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUgdG8gcmV0cmlldmUuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlIG9yIHRoZSB1c2VyIG9iamVjdCBpZiBub1xuICAgICAqIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSBuZ1Nlc3Npb24udXNlcignbmFtZScpOyAvLyA9PiAnSm9obiBTbWl0aCdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1c2VyKHByb3ApIHtcbiAgICAgIHZhciBzZXNzaW9uID0gJHJvb3RTY29wZS5zZXNzaW9uO1xuXG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wICYmIHNlc3Npb24udXNlcikge1xuICAgICAgICByZXR1cm4gc2Vzc2lvbi51c2VyW3Byb3BdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2Vzc2lvbi51c2VyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBhbnkgb3IgYWxsIG9mIHRoZSBwcm92aWRlZCByb2xlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7KFN0cmluZ3xTdHJpbmdbXSl9IHJvbGVzIFRoZSByZXF1aXJlZCByb2xlcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGFsbCBJZiBhbGwgdGhlIHByb3ZpZGVkIHJvbGVzIGFyZSByZXF1aXJlZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKCdST0xFLkFETUlOJyk7IC8vID0+IGZhbHNlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGUoJ1JPTEUuVVNFUicpOyAvLyA9PiB0cnVlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGUoWydST0xFLkFETUlOJywgJ1JPTEUuVVNFUiddKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKFsnUk9MRS5BRE1JTicsICdST0xFLlVTRVInXSwgdHJ1ZSk7IC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgYWxsKSB7XG4gICAgICB2YXIgYWN0dWFsID0gdXNlcigncm9sZXMnKTtcbiAgICAgIHZhciBtYXRjaGVzID0gMDtcblxuICAgICAgaWYgKCFhY3R1YWwgfHwgIWFjdHVhbC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAobmcuaXNTdHJpbmcoYWN0dWFsKSkge1xuICAgICAgICBhY3R1YWwgPSBbYWN0dWFsXTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKHJvbGVzKSkge1xuICAgICAgICByb2xlcyA9IFtyb2xlc107XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhY3R1YWwuaW5kZXhPZihyb2xlc1tpXSkgPiAtMSkge1xuICAgICAgICAgIG1hdGNoZXMrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYWxsKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzID09PSByb2xlcy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhIW1hdGNoZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhIHZhbHVlIGluIHRoZSBzZXNzaW9uIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBUaGUgcHJvcGVydHkgdmFsdWUgdG8gc2V0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnNldCgndGVzdCcsICdUZXN0IFZhbHVlJyk7XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0KHByb3AsIHZhbHVlKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW5zIGEgdmFsdWUgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBvYnRhaW4uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLmdldCgndGVzdCcpOyAvLyA9PiAnVGVzdCBWYWx1ZSdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXQocHJvcCkge1xuICAgICAgcmV0dXJuICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgcHJvcGVydHkgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmRlbCgndGVzdCcpO1xuICAgICAqIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gbnVsbFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbChwcm9wKSB7XG4gICAgICBkZWxldGUgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdO1xuICAgIH1cblxuICAgIC8qIFNlc3Npb24gc2VydmljZSBkZWZpbml0aW9uICovXG4gICAgdmFyIG5nU2Vzc2lvblNlcnZpY2VEZWYgPSB7XG4gICAgICBoYXNSb2xlOiBoYXNSb2xlLFxuICAgICAgc2lnbk91dDogc2lnbk91dCxcbiAgICAgIHNpZ25Jbjogc2lnbkluLFxuICAgICAgcmVsb2FkOiByZWxvYWQsXG4gICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgIHVzZXI6IHVzZXIsXG4gICAgICBnZXQ6IGdldCxcbiAgICAgIHNldDogc2V0LFxuICAgICAgZGVsOiBkZWxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5nU2Vzc2lvblNlcnZpY2VEZWY7XG4gIH1cblxuICAvKipcbiAgICogU2Vzc2lvbiByZXNvbHZlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gc2Vzc2lvblJlc29sdmVGbigkc2Vzc2lvbikge1xuICAgIGNvbnNvbGUubG9nKCdSZXNvbHZpbmcgc2Vzc2lvbi4uLicpO1xuXG4gICAgaWYgKG5nLmlzRGF0ZSh1cGRhdGVkQXQpKSB7XG4gICAgICBjb25zb2xlLmxvZygnVXBkYXRlZCBhdCBpcyBkYXRlLi4uJyk7XG5cbiAgICAgIGlmICh0eXBlb2YgZGVmYXVsdHMuY2FjaGUgPT0gJ2Jvb2xlYW4nICYmIGRlZmF1bHRzLmNhY2hlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDYWNoZSBpcyBib29sZWFuIGFuZCBzaG91bGQgbm90IHVwZGF0ZS4uLicpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChuZy5pc051bWJlcihkZWZhdWx0cy5jYWNoZSkgJiYgdXBkYXRlZEF0LnZhbHVlT2YoKSArIGRlZmF1bHRzLmNhY2hlID4gRGF0ZS5ub3coKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnQ2FjaGUgaXMgbnVtYmVyIGFuZCBzaG91bGQgbm90IHVwZGF0ZS4uLicpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1VwZGF0ZWQgYXQgaXMnLCB0eXBlb2YgdXBkYXRlZEF0KTtcblxuICAgIHJldHVybiAkc2Vzc2lvbi51cGRhdGUoKTtcbiAgfVxuXG4gIC8qIFNlc3Npb24gcmVzb2x2ZSBkZWZpbml0aW9uICovXG4gIHZhciBzZXNzaW9uUmVzb2x2ZURlZiA9IFsnbmdTZXNzaW9uJywgc2Vzc2lvblJlc29sdmVGbl07XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBydW4gZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBuZ1Nlc3Npb25SdW5Gbigkcm91dGUpIHtcbiAgICBmb3IgKHZhciBwYXRoIGluICRyb3V0ZS5yb3V0ZXMpIHtcbiAgICAgIHZhciByb3V0ZSA9ICRyb3V0ZS5yb3V0ZXNbcGF0aF07XG5cbiAgICAgIGlmICghbmcuaXNPYmplY3Qocm91dGUucmVzb2x2ZSkpIHtcbiAgICAgICAgcm91dGUucmVzb2x2ZSA9IHt9O1xuICAgICAgfVxuXG4gICAgICByb3V0ZS5yZXNvbHZlLl9zZXNzaW9uID0gc2Vzc2lvblJlc29sdmVEZWY7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtb2R1bGUgbmdTZXNzaW9uUHJvdmlkZXJcbiAgICogQGRlc2NyaXB0aW9uIG5nU2Vzc2lvbiBQcm92aWRlclxuICAgKi9cblxuICAvKipcbiAgICogQ29uZmlndXJhdGlvbiBtZXRob2QuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLnVwZGF0ZVVybCBUaGUgc2Vzc2lvbiB1cGRhdGUgVVJMIChHRVR8UFVUKS5cbiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5zaWduSW5VcmwgVGhlIHNlc3Npb24gc2lnbiBpbiBVUkwgKFBPU1QpLlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLnNpZ25PdXRVcmwgVGhlIHNlc3Npb24gc2lnbiBvdXQgVVJMIChQT1NUKS5cbiAgICogQHBhcmFtIHtOdW1iZXJ8Qm9vbGVhbn0gY2ZnLmNhY2hlIFRoZSBzZXNzaW9uIGNhY2hlIGJlaGF2aW9yLiBOdW1iZXIgaXMgdGhlIG1pbGxpc2Vjb25kcyB0byBjYWNoZSB0aGUgc2Vzc2lvbiBmb3IuXG4gICAqIEEgYm9vbGVhbiBcInRydWVcIiB3aWxsIGNhY2hlIHRoZSBzZXNzaW9uIGZvcmV2ZXIuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIG5nU2Vzc2lvblByb3ZpZGVyLmNvbmZpZ3VyZSh7XG4gICAqICAgc2lnbk91dFVybDogJy9hcGkvdXNlcnMvc2lnbi1vdXQnLFxuICAgKiAgIHNpZ25JblVybDogJy9hcGkvdXNlcnMvc2lnbi1pbicsXG4gICAqICAgdXBkYXRlVXJsOiAnL2FwaS9zZXNzaW9uJyxcbiAgICogICBjYWNoZTogJzFoJ1xuICAgKiB9KTtcbiAgICovXG4gIGZ1bmN0aW9uIGNvbmZpZ3VyZShjZmcpIHtcbiAgICAvKiBTZXRzIHNlc3Npb24gdXBkYXRlIEdFVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnVwZGF0ZVVybCkpIHtcbiAgICAgIGRlZmF1bHRzLnVwZGF0ZVVybCA9IGNmZy51cGRhdGVVcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyBzaWduIGluIFBPU1QgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy5zaWduSW5VcmwpKSB7XG4gICAgICBkZWZhdWx0cy5zaWduSW5VcmwgPSBjZmcuc2lnbkluVXJsO1xuICAgIH1cblxuICAgIC8qIFNldHMgc2lnbiBvdXQgUE9TVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnNpZ25PdXRVcmwpKSB7XG4gICAgICBkZWZhdWx0cy5zaWduT3V0VXJsID0gY2ZnLnNpZ25PdXRVcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyB0aGUgY2FjaGUgYmVoYXZpb3IgKi9cbiAgICBpZiAobmcuaXNOdW1iZXIoY2ZnLmNhY2hlKSB8fCB0eXBlb2YgY2ZnLmNhY2hlID09ICdib29sZWFuJykge1xuICAgICAgZGVmYXVsdHMuY2FjaGUgPSBjZmcuY2FjaGU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBwcm92aWRlciBkZWZpbml0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdmFyIG5nU2Vzc2lvblByb3ZpZGVyRGVmID0ge1xuICAgIGNvbmZpZ3VyZTogY29uZmlndXJlLFxuXG4gICAgJGdldDogWyckcm9vdFNjb3BlJywgJyRodHRwJywgJyRxJywgbmdTZXNzaW9uU2VydmljZUZuXVxuICB9O1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcHJvdmlkZXIgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBuZ1Nlc3Npb25Qcm92aWRlckZuKCkge1xuICAgIHJldHVybiBuZ1Nlc3Npb25Qcm92aWRlckRlZjtcbiAgfVxuXG4gIC8qIERlZmluZSBBbmd1bGFySlMgbW9kdWxlICovXG4gIG5nLm1vZHVsZSgnbmdTZXNzaW9uJywgW10pXG5cbiAgICAvKiBEZWZpbmUgc2VydmljZSBwcm92aWRlciAqL1xuICAgIC5wcm92aWRlcignbmdTZXNzaW9uJywgbmdTZXNzaW9uUHJvdmlkZXJGbilcblxuICAgIC8qIERlZmluZSBBbmd1bGFySlMgbW9kdWxlIHJ1biBmdW5jdGlvbiAqL1xuICAgIC5ydW4oWyckcm91dGUnLCBuZ1Nlc3Npb25SdW5Gbl0pO1xufSkod2luZG93KTtcbiJdfQ==
