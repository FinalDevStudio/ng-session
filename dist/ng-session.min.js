!function(n){"use strict";function e(n,e,r){function s(e,r){n.session.user=r.data,e.resolve(r)}function t(n){return g(null,n)}function i(e,r){n.session.user=null,e.resolve(r)}function l(s,i){var u=r.defer();return n.session.user=null,e.post(o.signInUrl,s,i).then(t.bind(null,u)).catch(u.reject),u.promise}function c(n,s){var t=r.defer();return e.post(o.signOutUrl,n,s).then(i.bind(null,t)).catch(t.reject),t.promise}function a(n,s,t){return t||(t=r.defer()),e.put(o.updateUrl,n,s||{}).then(g.bind(null,s,t)).catch(t.reject),t.promise}function g(n,t){return t||(t=r.defer()),e.get(o.updateUrl,n||{}).then(s.bind(null,t)).catch(t.reject),t.promise}function f(e){var r=n.session;return r?e&&r.user?r.user[e]:r.user:null}function d(n,e){var r=f("roles"),s=0;if(!r||!r.length)return!1;u.isString(r)&&(r=[r]),u.isString(n)&&(n=[n]);for(var t=0,i=n.length;t<i;t++)r.indexOf(n[t])>-1&&s++;return e?s===n.length:!!s}function p(e,r){n.session[e]=r}function U(e){return n.session[e]}function v(e){delete n.session[e]}n.session={};var h={hasRole:d,signOut:c,signIn:l,reload:a,update:g,user:f,get:U,set:p,del:v};return h}function r(n){return n.update({cache:!0})}function s(n){for(var e in n.routes){var r=n.routes[e];u.isObject(r.resolve)||(r.resolve={}),r.resolve.__ngsession=l}}function t(n){u.isString(n.updateUrl)&&(o.updateUrl=n.updateUrl),u.isString(n.signInUrl)&&(o.signInUrl=n.signInUrl),u.isString(n.signOutUrl)&&(o.signOutUrl=n.signOutUrl)}function i(){return c}var u=n.angular,o={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/api/session"},l=["ngSession",r],c={configure:t,$get:["$rootScope","$http","$q",e]};u.module("ngSession",[]).provider("ngSession",i).run(["$route",s])}(window);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwibmdTZXNzaW9uU2VydmljZUZuIiwiJHJvb3RTY29wZSIsIiRodHRwIiwiJHEiLCJvblNlc3Npb25VcGRhdGVTdWNjZXNzIiwiZGVmZXJyZWQiLCJyZXMiLCJzZXNzaW9uIiwidXNlciIsImRhdGEiLCJyZXNvbHZlIiwib25TaW5nSW5TdWNjZXNzIiwidXBkYXRlIiwib25TaW5nT3V0U3VjY2VzcyIsInNpZ25JbiIsIm9wdGlvbnMiLCJkZWZlciIsInBvc3QiLCJjb25maWciLCJzaWduSW5VcmwiLCJ0aGVuIiwiYmluZCIsImNhdGNoIiwicmVqZWN0IiwicHJvbWlzZSIsInNpZ25PdXQiLCJzaWduT3V0VXJsIiwicmVsb2FkIiwicHV0IiwidXBkYXRlVXJsIiwiZ2V0IiwicHJvcCIsImhhc1JvbGUiLCJyb2xlcyIsImFsbCIsImFjdHVhbCIsIm1hdGNoZXMiLCJsZW5ndGgiLCJuZyIsImlzU3RyaW5nIiwiaSIsImwiLCJpbmRleE9mIiwic2V0IiwidmFsdWUiLCJkZWwiLCJuZ1Nlc3Npb25TZXJ2aWNlRGVmIiwic2Vzc2lvblJlc29sdmVGbiIsIiRzZXNzaW9uIiwiY2FjaGUiLCJuZ1Nlc3Npb25SdW5GbiIsIiRyb3V0ZSIsInBhdGgiLCJyb3V0ZXMiLCJyb3V0ZSIsImlzT2JqZWN0IiwiX19uZ3Nlc3Npb24iLCJzZXNzaW9uUmVzb2x2ZURlZiIsImNvbmZpZ3VyZSIsImNmZyIsIm5nU2Vzc2lvblByb3ZpZGVyRm4iLCJuZ1Nlc3Npb25Qcm92aWRlckRlZiIsImFuZ3VsYXIiLCIkZ2V0IiwibW9kdWxlIiwicHJvdmlkZXIiLCJydW4iXSwibWFwcGluZ3MiOiJDQVNDLFNBQVVBLEdBQ1QsWUFnQkEsU0FBU0MsR0FBbUJDLEVBQVlDLEVBQU9DLEdBYTdDLFFBQVNDLEdBQXVCQyxFQUFVQyxHQUN4Q0wsRUFBV00sUUFBUUMsS0FBT0YsRUFBSUcsS0FFOUJKLEVBQVNLLFFBQVFKLEdBUW5CLFFBQVNL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SWpDLGNBQ2xCUixFQUFPUSxXQUFhaUMsRUFBSWpDLFlBd0I1QixRQUFTa0MsS0FDUCxNQUFPQyxHQXZYVCxHQUFJdkIsR0FBS3ZDLEVBQU8rRCxRQUdaNUMsR0FDRlEsV0FBWSxzQkFDWlAsVUFBVyxxQkFDWFUsVUFBVyxnQkFtU1Q0QixHQUNGLFlBRUFWLEdBMkRFYyxHQUNGSCxVQUFXQSxFQUVYSyxNQUNFLGFBQWMsUUFBUyxLQUV2Qi9ELEdBY0pzQyxHQUFHMEIsT0FBTyxnQkFHVEMsU0FBUyxZQUFhTCxHQUd0Qk0sS0FBSyxTQUFVaEIsS0FFaEJuRCIsImZpbGUiOiJuZy1zZXNzaW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBuZ1Nlc3Npb25cbiAqXG4gKiBAZGVzY3JpcHRpb24gU2Vzc2lvbiBoYW5kbGVyIG1vZHVsZSBmb3IgQW5ndWxhckpTLlxuICogQG1vZHVsZSBuZ1Nlc3Npb25cbiAqIEBhdXRob3IgRmluYWwgRGV2ZWxvcG1lbnQgU3R1ZGlvXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG5nID0gd2luZG93LmFuZ3VsYXI7XG5cbiAgLyogRGVmYXVsdCBjb25maWd1cmF0aW9uICovXG4gIHZhciBjb25maWcgPSB7XG4gICAgc2lnbk91dFVybDogJy9hcGkvdXNlcnMvc2lnbi1vdXQnLFxuICAgIHNpZ25JblVybDogJy9hcGkvdXNlcnMvc2lnbi1pbicsXG4gICAgdXBkYXRlVXJsOiAnL2FwaS9zZXNzaW9uJ1xuICB9O1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gc2VydmljZSBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblNlcnZpY2VGbigkcm9vdFNjb3BlLCAkaHR0cCwgJHEpIHtcbiAgICAkcm9vdFNjb3BlLnNlc3Npb24gPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gICAgICogQGRlc2NyaXB0aW9uIG5nU2Vzc2lvbiBTZXJ2aWNlXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBTZXNzaW9uIHVwZGF0ZSBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNlc3Npb25VcGRhdGVTdWNjZXNzKGRlZmVycmVkLCByZXMpIHtcbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gcmVzLmRhdGE7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbiBTaWduIEluIHN1Y2Nlc3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2luZ0luU3VjY2VzcyhkZWZlcnJlZCkge1xuICAgICAgcmV0dXJuIHVwZGF0ZShudWxsLCBkZWZlcnJlZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT24gU2lnbiBPdXQgc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TaW5nT3V0U3VjY2VzcyhkZWZlcnJlZCwgcmVzKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IG51bGw7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgaW4uXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBgUE9TVGAgdG8gdGhlIGBjb25maWcuc2lnbk91dFVybGAgcGF0aCBhbmQgcGVyZm9ybSBhblxuICAgICAqIGB1cGRhdGVgIGlmIHN1Y2Nlc3NmdWwuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byBzZW5kIGZvciBzaWduIGluLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3Qgb3B0aW9ucy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24uc2lnbkluKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2lnbkluKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIC8qIFJlbW92ZSBwcmV2aW91cyB1c2VyIG9iamVjdCAqL1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uLnVzZXIgPSBudWxsO1xuXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5zaWduSW5VcmwsIGRhdGEsIG9wdGlvbnMpXG4gICAgICAgIC50aGVuKG9uU2luZ0luU3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpZ25zIGEgdXNlciBvdXQuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBQT1NUIHRvIHRoZSBgY29uZmlnLnNpZ25PdXRVcmxgIHBhdGggYW5kIGRlbGV0ZSB0aGVcbiAgICAgKiB1c2VyIG9iamVjdCBvbiBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBvdXQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBvcHRpb25zLlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5zaWduT3V0KCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2lnbk91dChkYXRhLCBvcHRpb25zKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5zaWduT3V0VXJsLCBkYXRhLCBvcHRpb25zKVxuICAgICAgICAudGhlbihvblNpbmdPdXRTdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpKVxuICAgICAgICAuY2F0Y2goZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVsb2FkcyB0aGUgc2Vzc2lvbiB1c2VyIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIFBVVCB0byB0aGUgYGNvbmZpZy51cGRhdGVVcmxgIHBhdGggYW5kIHRoZW4gYVxuICAgICAqIGNvbnNlY3VlbnQgc2Vzc2lvbiBgdXBkYXRlYC5cbiAgICAgKlxuICAgICAqIFRoZSBzZXJ2ZXIgc2hvdWxkIGhhbmRsZSB0aGUgT1V0IHJlcXVlc3QgYXMgYSByZWxvYWQgcmVxdWVzdCBhbmQgZmV0Y2hcbiAgICAgKiB1cGRhdGVkIHNlc3Npb24gZGF0YS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3Qgb3B0aW9ucy5cbiAgICAgKiBAcGFyYW0ge1Byb21pc2V9IGRlZmVycmVkIE9wdGlvbmFsIGRlZmVycmVkIHByb21pc2Ugb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5yZWxvYWQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWxvYWQoZGF0YSwgb3B0aW9ucywgZGVmZXJyZWQpIHtcbiAgICAgIGlmICghZGVmZXJyZWQpIHtcbiAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgfVxuXG4gICAgICAvKiBSZWxvYWRzIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHAucHV0KGNvbmZpZy51cGRhdGVVcmwsIGRhdGEsIG9wdGlvbnMgfHwge30pXG4gICAgICAgIC50aGVuKHVwZGF0ZS5iaW5kKG51bGwsIG9wdGlvbnMsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHNlc3Npb24gdXNlciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBHRVQgdG8gdGhlIGBjb25maWcudXBkYXRlVXJsYCBwYXRoIGFuZCBzZXQgdGhlXG4gICAgICogc2Vzc2lvbidzIHVzZXIgb2JqZWN0IG9uIHN1Y2Nlc3Mgd2l0aCB0aGUgcmVxdWVzdCdzIGByZXMuZGF0YWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IG9wdGlvbnMuXG4gICAgICogQHBhcmFtIHtQcm9taXNlfSBkZWZlcnJlZCBPcHRpb25hbCBkZWZlcnJlZCBwcm9taXNlIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24udXBkYXRlKClcbiAgICAgKiAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZShvcHRpb25zLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJldHJpZXZlIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy51cGRhdGVVcmwsIG9wdGlvbnMgfHwge30pXG4gICAgICAgIC50aGVuKG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MuYmluZChudWxsLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgYSB1c2VyIGRhdGEgdmFsdWUgYnkgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHJldHJpZXZlLlxuICAgICAqXG4gICAgICogQHJldHVybnMge01peGVkfSBUaGUgcHJvcGVydHkncyB2YWx1ZSBvciB0aGUgdXNlciBvYmplY3QgaWYgbm9cbiAgICAgKiBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnVzZXIoJ25hbWUnKTsgLy8gPT4gJ0pvaG4gU21pdGgnXG4gICAgICovXG4gICAgZnVuY3Rpb24gdXNlcihwcm9wKSB7XG4gICAgICB2YXIgc2Vzc2lvbiA9ICRyb290U2NvcGUuc2Vzc2lvbjtcblxuICAgICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvcCAmJiBzZXNzaW9uLnVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHNlc3Npb24udXNlcltwcm9wXTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNlc3Npb24udXNlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgYW55IG9yIGFsbCBvZiB0aGUgcHJvdmlkZWQgcm9sZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0geyhTdHJpbmd8U3RyaW5nW10pfSByb2xlcyBUaGUgcmVxdWlyZWQgcm9sZXMuIENhbiBiZSBhIHNpbmdsZVxuICAgICAqICAgc3RyaW5nIG9yIGEgc3RyaW5nIGFycmF5LlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gYWxsIElmIGFsbCB0aGUgcHJvdmlkZWQgcm9sZXMgYXJlIHJlcXVpcmVkLlxuICAgICAqXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGVzKCdST0xFLkFETUlOJyk7IC8vID0+IGZhbHNlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGVzKCdST0xFLlVTRVInKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlcyhbJ1JPTEUuQURNSU4nLCAnUk9MRS5VU0VSJ10pOyAvLyA9PiB0cnVlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGVzKFsnUk9MRS5BRE1JTicsICdST0xFLlVTRVInXSwgdHJ1ZSk7IC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgYWxsKSB7XG4gICAgICB2YXIgYWN0dWFsID0gdXNlcigncm9sZXMnKTtcbiAgICAgIHZhciBtYXRjaGVzID0gMDtcblxuICAgICAgaWYgKCFhY3R1YWwgfHwgIWFjdHVhbC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAobmcuaXNTdHJpbmcoYWN0dWFsKSkge1xuICAgICAgICBhY3R1YWwgPSBbYWN0dWFsXTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKHJvbGVzKSkge1xuICAgICAgICByb2xlcyA9IFtyb2xlc107XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhY3R1YWwuaW5kZXhPZihyb2xlc1tpXSkgPiAtMSkge1xuICAgICAgICAgIG1hdGNoZXMrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYWxsKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzID09PSByb2xlcy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhIW1hdGNoZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhIHZhbHVlIGluIHRoZSBzZXNzaW9uIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBUaGUgcHJvcGVydHkgdmFsdWUgdG8gc2V0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnNldCgndGVzdCcsICdUZXN0IFZhbHVlJyk7XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0KHByb3AsIHZhbHVlKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW5zIGEgdmFsdWUgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBvYnRhaW4uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLmdldCgndGVzdCcpOyAvLyA9PiAnVGVzdCBWYWx1ZSdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXQocHJvcCkge1xuICAgICAgcmV0dXJuICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgcHJvcGVydHkgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmRlbCgndGVzdCcpO1xuICAgICAqIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gbnVsbFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbChwcm9wKSB7XG4gICAgICBkZWxldGUgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdO1xuICAgIH1cblxuICAgIC8qIFNlc3Npb24gc2VydmljZSBkZWZpbml0aW9uICovXG4gICAgdmFyIG5nU2Vzc2lvblNlcnZpY2VEZWYgPSB7XG4gICAgICBoYXNSb2xlOiBoYXNSb2xlLFxuICAgICAgc2lnbk91dDogc2lnbk91dCxcbiAgICAgIHNpZ25Jbjogc2lnbkluLFxuICAgICAgcmVsb2FkOiByZWxvYWQsXG4gICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgIHVzZXI6IHVzZXIsXG4gICAgICBnZXQ6IGdldCxcbiAgICAgIHNldDogc2V0LFxuICAgICAgZGVsOiBkZWxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5nU2Vzc2lvblNlcnZpY2VEZWY7XG4gIH1cblxuICBmdW5jdGlvbiBzZXNzaW9uUmVzb2x2ZUZuKCRzZXNzaW9uKSB7XG4gICAgcmV0dXJuICRzZXNzaW9uLnVwZGF0ZSh7XG4gICAgICBjYWNoZTogdHJ1ZVxuICAgIH0pO1xuICB9XG5cbiAgdmFyIHNlc3Npb25SZXNvbHZlRGVmID0gW1xuICAgICduZ1Nlc3Npb24nLFxuXG4gICAgc2Vzc2lvblJlc29sdmVGblxuICBdO1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcnVuIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uUnVuRm4oJHJvdXRlKSB7XG4gICAgZm9yICh2YXIgcGF0aCBpbiAkcm91dGUucm91dGVzKSB7XG4gICAgICB2YXIgcm91dGUgPSAkcm91dGUucm91dGVzW3BhdGhdO1xuXG4gICAgICBpZiAoIW5nLmlzT2JqZWN0KHJvdXRlLnJlc29sdmUpKSB7XG4gICAgICAgIHJvdXRlLnJlc29sdmUgPSB7fTtcbiAgICAgIH1cblxuICAgICAgcm91dGUucmVzb2x2ZS5fX25nc2Vzc2lvbiA9IHNlc3Npb25SZXNvbHZlRGVmO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbW9kdWxlIG5nU2Vzc2lvblByb3ZpZGVyXG4gICAqIEBkZXNjcmlwdGlvbiBuZ1Nlc3Npb24gUHJvdmlkZXJcbiAgICovXG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gbWV0aG9kLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogbmdTZXNzaW9uUHJvdmlkZXIuY29uZmlndXJlKHtcbiAgICogICBzaWduT3V0VXJsOiAnL2FwaS91c2Vycy9zaWduLW91dCcsXG4gICAqICAgc2lnbkluVXJsOiAnL2FwaS91c2Vycy9zaWduLWluJyxcbiAgICogICB1cGRhdGVVcmw6ICcvYXBpL3Nlc3Npb24nXG4gICAqIH0pO1xuICAgKi9cbiAgZnVuY3Rpb24gY29uZmlndXJlKGNmZykge1xuICAgIC8qIFNldHMgc2Vzc2lvbiB1cGRhdGUgR0VUIFVSTCAqL1xuICAgIGlmIChuZy5pc1N0cmluZyhjZmcudXBkYXRlVXJsKSkge1xuICAgICAgY29uZmlnLnVwZGF0ZVVybCA9IGNmZy51cGRhdGVVcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyBzaWduIGluIFBPU1QgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy5zaWduSW5VcmwpKSB7XG4gICAgICBjb25maWcuc2lnbkluVXJsID0gY2ZnLnNpZ25JblVybDtcbiAgICB9XG5cbiAgICAvKiBTZXRzIHNpZ24gb3V0IFBPU1QgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy5zaWduT3V0VXJsKSkge1xuICAgICAgY29uZmlnLnNpZ25PdXRVcmwgPSBjZmcuc2lnbk91dFVybDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogbmdTZXNzaW9uIHByb3ZpZGVyIGRlZmluaXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB2YXIgbmdTZXNzaW9uUHJvdmlkZXJEZWYgPSB7XG4gICAgY29uZmlndXJlOiBjb25maWd1cmUsXG5cbiAgICAkZ2V0OiBbXG4gICAgICAnJHJvb3RTY29wZScsICckaHR0cCcsICckcScsXG5cbiAgICAgIG5nU2Vzc2lvblNlcnZpY2VGblxuICAgIF1cbiAgfTtcblxuICAvKipcbiAgICogbmdTZXNzaW9uIHByb3ZpZGVyIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uUHJvdmlkZXJGbigpIHtcbiAgICByZXR1cm4gbmdTZXNzaW9uUHJvdmlkZXJEZWY7XG4gIH1cblxuICAvKiBEZWZpbmUgQW5ndWxhckpTIG1vZHVsZSAqL1xuICBuZy5tb2R1bGUoJ25nU2Vzc2lvbicsIFtdKVxuXG4gIC8qIERlZmluZSBzZXJ2aWNlIHByb3ZpZGVyICovXG4gIC5wcm92aWRlcignbmdTZXNzaW9uJywgbmdTZXNzaW9uUHJvdmlkZXJGbilcblxuICAvKiBEZWZpbmUgQW5ndWxhckpTIG1vZHVsZSBydW4gZnVuY3Rpb24gKi9cbiAgLnJ1bihbJyRyb3V0ZScsIG5nU2Vzc2lvblJ1bkZuXSk7XG5cbn0od2luZG93KSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
