!function(n){"use strict";var r,l=window.angular,c={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/api/session",cache:!1};var s=["ngSession",function(n){if(r){if(l.isBoolean(c.cache)||c.cache)return null;if(l.isNumber(c.cache)||r.valueOf()+c.cache<Date.now())return null}return n.update()}];var e={configure:function(n){l.isString(n.updateUrl)&&(c.updateUrl=n.updateUrl),l.isString(n.signInUrl)&&(c.signInUrl=n.signInUrl),l.isString(n.signOutUrl)&&(c.signOutUrl=n.signOutUrl),(l.isNumber(n.cache)||l.isBoolean(n.cache))&&(c.cache=n.cache)},$get:["$rootScope","$http","$q",function(s,t,i){function u(n,e){return e||(e=i.defer()),t.get(c.updateUrl,n).then(function(n,e){s.session.user=e.data,r=new Date,n.resolve(e)}.bind(null,e)).catch(e.reject),e.promise}function o(n){var e=s.session;return e?n&&e.user?e.user[n]:e.user:null}return s.session={},{hasRole:function(n,e){var r=o("roles"),s=0;if(!r||!r.length)return!1;l.isString(r)&&(r=[r]),l.isString(n)&&(n=[n]);for(var t=0,i=n.length;t<i;t++)-1<r.indexOf(n[t])&&s++;return e?s===n.length:!!s},signOut:function(n,e){var r=i.defer();return t.post(c.signOutUrl,n,e).then(function(n,e){s.session.user=null,n.resolve(e)}.bind(null,r)).catch(r.reject),r.promise},signIn:function(n,e){var r=i.defer();return s.session.user=null,t.post(c.signInUrl,n,e).then(function(n){return u(null,n)}.bind(null,r)).catch(r.reject),r.promise},reload:function(n,e,r){return r||(r=i.defer()),t.put(c.updateUrl,n,e).then(u.bind(null,e,r)).catch(r.reject),r.promise},update:u,user:o,get:function(n){return s.session[n]},set:function(n,e){s.session[n]=e},del:function(n){delete s.session[n]}}}]};l.module("ngSession",[]).provider("ngSession",function(){return e}).run(["$route",function(n){for(var e in n.routes){var r=n.routes[e];l.isObject(r.resolve)||(r.resolve={}),r.resolve._session=s}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwidXBkYXRlZEF0IiwibmciLCJhbmd1bGFyIiwiZGVmYXVsdHMiLCJzaWduT3V0VXJsIiwic2lnbkluVXJsIiwidXBkYXRlVXJsIiwiY2FjaGUiLCJzZXNzaW9uUmVzb2x2ZURlZiIsIiRzZXNzaW9uIiwiaXNCb29sZWFuIiwiaXNOdW1iZXIiLCJ2YWx1ZU9mIiwiRGF0ZSIsIm5vdyIsInVwZGF0ZSIsIm5nU2Vzc2lvblByb3ZpZGVyRGVmIiwiY29uZmlndXJlIiwiY2ZnIiwiaXNTdHJpbmciLCIkZ2V0IiwiJHJvb3RTY29wZSIsIiRodHRwIiwiJHEiLCJjb25maWciLCJkZWZlcnJlZCIsImRlZmVyIiwiZ2V0IiwidGhlbiIsInJlcyIsInNlc3Npb24iLCJ1c2VyIiwiZGF0YSIsInJlc29sdmUiLCJiaW5kIiwiY2F0Y2giLCJyZWplY3QiLCJwcm9taXNlIiwicHJvcCIsImhhc1JvbGUiLCJyb2xlcyIsImFsbCIsImFjdHVhbCIsIm1hdGNoZXMiLCJsZW5ndGgiLCJpIiwibCIsImluZGV4T2YiLCJzaWduT3V0IiwicG9zdCIsInNpZ25JbiIsInJlbG9hZCIsInB1dCIsInNldCIsInZhbHVlIiwiZGVsIiwibW9kdWxlIiwicHJvdmlkZXIiLCJydW4iLCIkcm91dGUiLCJwYXRoIiwicm91dGVzIiwicm91dGUiLCJpc09iamVjdCIsIl9zZXNzaW9uIl0sIm1hcHBpbmdzIjoiQ0FTQSxTQUFVQSxHQUNSLGFBRUEsSUFVSUMsRUFWQUMsRUE0WkhGLE9BNVplRyxRQUdaQyxFQUFXLENBQ2JDLFdBQVksc0JBQ1pDLFVBQVcscUJBQ1hDLFVBQVcsZUFDWEMsT0FBTyxHQXlUVCxJQUFJQyxFQUFvQixDQUFDLFlBZnpCLFNBQTBCQyxHQUN4QixHQUFJVCxFQUFXLENBQ2IsR0FBSUMsRUFBR1MsVUFBVVAsRUFBU0ksUUFBVUosRUFBU0ksTUFDM0MsT0FBTyxLQUdULEdBQUlOLEVBQUdVLFNBQVNSLEVBQVNJLFFB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QUFXUyxRQUFRUSxRQTRIOUJyQyxFQUFHdUQsT0FBTyxZQUFhLElBR3BCQyxTQUFTLFlBUlosV0FDRSxPQUFPekMsSUFVTjBDLElBQUksQ0FBQyxTQXBGUixTQUF3QkMsR0FDdEIsSUFBSyxJQUFJQyxLQUFRRCxFQUFPRSxPQUFRLENBQzlCLElBQUlDLEVBQVFILEVBQU9FLE9BQU9ELEdBRXJCM0QsRUFBRzhELFNBQVNELEVBQU03QixXQUNyQjZCLEVBQU03QixRQUFVLElBR2xCNkIsRUFBTTdCLFFBQVErQixTQUFXeEQsTUFsVi9CIiwiZmlsZSI6Im5nLXNlc3Npb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIG5nU2Vzc2lvblxuICpcbiAqIEBkZXNjcmlwdGlvbiBTZXNzaW9uIGhhbmRsZXIgbW9kdWxlIGZvciBBbmd1bGFySlMuXG4gKiBAbW9kdWxlIG5nU2Vzc2lvblxuICogQGF1dGhvciBGaW5hbCBEZXZlbG9wbWVudCBTdHVkaW9cbiAqIEBsaWNlbnNlIE1JVFxuICovXG5cbihmdW5jdGlvbih3aW5kb3cpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBuZyA9IHdpbmRvdy5hbmd1bGFyO1xuXG4gIC8qIERlZmF1bHQgY29uZmlndXJhdGlvbiAqL1xuICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgc2lnbk91dFVybDogJy9hcGkvdXNlcnMvc2lnbi1vdXQnLFxuICAgIHNpZ25JblVybDogJy9hcGkvdXNlcnMvc2lnbi1pbicsXG4gICAgdXBkYXRlVXJsOiAnL2FwaS9zZXNzaW9uJyxcbiAgICBjYWNoZTogZmFsc2VcbiAgfTtcblxuICB2YXIgdXBkYXRlZEF0O1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gc2VydmljZSBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblNlcnZpY2VGbigkcm9vdFNjb3BlLCAkaHR0cCwgJHEpIHtcbiAgICAkcm9vdFNjb3BlLnNlc3Npb24gPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gICAgICogQGRlc2NyaXB0aW9uIG5nU2Vzc2lvbiBTZXJ2aWNlXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBTZXNzaW9uIHVwZGF0ZSBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNlc3Npb25VcGRhdGVTdWNjZXNzKGRlZmVycmVkLCByZXMpIHtcbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gcmVzLmRhdGE7XG5cbiAgICAgIHVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbiBTaWduIEluIHN1Y2Nlc3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2luZ0luU3VjY2VzcyhkZWZlcnJlZCkge1xuICAgICAgcmV0dXJuIHVwZGF0ZShudWxsLCBkZWZlcnJlZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT24gU2lnbiBPdXQgc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TaW5nT3V0U3VjY2VzcyhkZWZlcnJlZCwgcmVzKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IG51bGw7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgaW4uXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBgUE9TVGAgdG8gdGhlIGBkZWZhdWx0cy5zaWduT3V0VXJsYCBwYXRoIGFuZCBwZXJmb3JtIGFuXG4gICAgICogYHVwZGF0ZWAgaWYgc3VjY2Vzc2Z1bC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHRvIHNlbmQgZm9yIHNpZ24gaW4uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnNpZ25Jbigkc2NvcGUuZGF0YSlcbiAgICAgKiAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNpZ25JbihkYXRhLCBjb25maWcpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIC8qIFJlbW92ZSBwcmV2aW91cyB1c2VyIG9iamVjdCAqL1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uLnVzZXIgPSBudWxsO1xuXG4gICAgICAkaHR0cFxuICAgICAgICAucG9zdChkZWZhdWx0cy5zaWduSW5VcmwsIGRhdGEsIGNvbmZpZylcbiAgICAgICAgLnRoZW4ob25TaW5nSW5TdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpKVxuICAgICAgICAuY2F0Y2goZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2lnbnMgYSB1c2VyIG91dC5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIFBPU1QgdG8gdGhlIGBkZWZhdWx0cy5zaWduT3V0VXJsYCBwYXRoIGFuZCBkZWxldGUgdGhlXG4gICAgICogdXNlciBvYmplY3Qgb24gc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBvcHRpb25hbCBkYXRhIHRvIHNlbmQgZm9yIHNpZ24gb3V0LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBjb25maWd1cmF0aW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5zaWduT3V0KCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2lnbk91dChkYXRhLCBjb25maWcpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRodHRwXG4gICAgICAgIC5wb3N0KGRlZmF1bHRzLnNpZ25PdXRVcmwsIGRhdGEsIGNvbmZpZylcbiAgICAgICAgLnRoZW4ob25TaW5nT3V0U3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbG9hZHMgdGhlIHNlc3Npb24gdXNlciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBQVVQgdG8gdGhlIGBkZWZhdWx0cy51cGRhdGVVcmxgIHBhdGggYW5kIHRoZW4gYVxuICAgICAqIGNvbnNlY3VlbnQgc2Vzc2lvbiBgdXBkYXRlYC5cbiAgICAgKlxuICAgICAqIFRoZSBzZXJ2ZXIgc2hvdWxkIGhhbmRsZSB0aGUgT1V0IHJlcXVlc3QgYXMgYSByZWxvYWQgcmVxdWVzdCBhbmQgZmV0Y2hcbiAgICAgKiB1cGRhdGVkIHNlc3Npb24gZGF0YS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBvcHRpb25hbCBkYXRhIHRvIHNlbmQgZm9yIHRoZSByZWxvYWQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICogQHBhcmFtIHtQcm9taXNlfSBkZWZlcnJlZCBPcHRpb25hbCBkZWZlcnJlZCBwcm9taXNlIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24ucmVsb2FkKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVsb2FkKGRhdGEsIGNvbmZpZywgZGVmZXJyZWQpIHtcbiAgICAgIGlmICghZGVmZXJyZWQpIHtcbiAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgfVxuXG4gICAgICAvKiBSZWxvYWRzIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHBcbiAgICAgICAgLnB1dChkZWZhdWx0cy51cGRhdGVVcmwsIGRhdGEsIGNvbmZpZylcbiAgICAgICAgLnRoZW4odXBkYXRlLmJpbmQobnVsbCwgY29uZmlnLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBzZXNzaW9uIHVzZXIgb2JqZWN0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgR0VUIHRvIHRoZSBgZGVmYXVsdHMudXBkYXRlVXJsYCBwYXRoIGFuZCBzZXQgdGhlXG4gICAgICogc2Vzc2lvbidzIHVzZXIgb2JqZWN0IG9uIHN1Y2Nlc3Mgd2l0aCB0aGUgcmVxdWVzdCdzIGByZXMuZGF0YWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge1Byb21pc2V9IGRlZmVycmVkIE9wdGlvbmFsIGRlZmVycmVkIHByb21pc2Ugb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi51cGRhdGUoKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gdXBkYXRlKGNvbmZpZywgZGVmZXJyZWQpIHtcbiAgICAgIGlmICghZGVmZXJyZWQpIHtcbiAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgfVxuXG4gICAgICAvKiBSZXRyaWV2ZSBjdXJyZW50IHNlc3Npb24gKi9cbiAgICAgICRodHRwXG4gICAgICAgIC5nZXQoZGVmYXVsdHMudXBkYXRlVXJsLCBjb25maWcpXG4gICAgICAgIC50aGVuKG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MuYmluZChudWxsLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgYSB1c2VyIGRhdGEgdmFsdWUgYnkgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHJldHJpZXZlLlxuICAgICAqXG4gICAgICogQHJldHVybnMge01peGVkfSBUaGUgcHJvcGVydHkncyB2YWx1ZSBvciB0aGUgdXNlciBvYmplY3QgaWYgbm9cbiAgICAgKiBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnVzZXIoJ25hbWUnKTsgLy8gPT4gJ0pvaG4gU21pdGgnXG4gICAgICovXG4gICAgZnVuY3Rpb24gdXNlcihwcm9wKSB7XG4gICAgICB2YXIgc2Vzc2lvbiA9ICRyb290U2NvcGUuc2Vzc2lvbjtcblxuICAgICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvcCAmJiBzZXNzaW9uLnVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHNlc3Npb24udXNlcltwcm9wXTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNlc3Npb24udXNlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgYW55IG9yIGFsbCBvZiB0aGUgcHJvdmlkZWQgcm9sZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0geyhTdHJpbmd8U3RyaW5nW10pfSByb2xlcyBUaGUgcmVxdWlyZWQgcm9sZXMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBhbGwgSWYgYWxsIHRoZSBwcm92aWRlZCByb2xlcyBhcmUgcmVxdWlyZWQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24uaGFzUm9sZSgnUk9MRS5BRE1JTicpOyAvLyA9PiBmYWxzZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKCdST0xFLlVTRVInKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKFsnUk9MRS5BRE1JTicsICdST0xFLlVTRVInXSk7IC8vID0+IHRydWVcbiAgICAgKiBuZ1Nlc3Npb24uaGFzUm9sZShbJ1JPTEUuQURNSU4nLCAnUk9MRS5VU0VSJ10sIHRydWUpOyAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhhc1JvbGUocm9sZXMsIGFsbCkge1xuICAgICAgdmFyIGFjdHVhbCA9IHVzZXIoJ3JvbGVzJyk7XG4gICAgICB2YXIgbWF0Y2hlcyA9IDA7XG5cbiAgICAgIGlmICghYWN0dWFsIHx8ICFhY3R1YWwubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKGFjdHVhbCkpIHtcbiAgICAgICAgYWN0dWFsID0gW2FjdHVhbF07XG4gICAgICB9XG5cbiAgICAgIGlmIChuZy5pc1N0cmluZyhyb2xlcykpIHtcbiAgICAgICAgcm9sZXMgPSBbcm9sZXNdO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJvbGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoYWN0dWFsLmluZGV4T2Yocm9sZXNbaV0pID4gLTEpIHtcbiAgICAgICAgICBtYXRjaGVzKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGFsbCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlcyA9PT0gcm9sZXMubGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gISFtYXRjaGVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgYSB2YWx1ZSBpbiB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBzZXQuXG4gICAgICogQHBhcmFtIHtNaXhlZH0gVGhlIHByb3BlcnR5IHZhbHVlIHRvIHNldC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIG5nU2Vzc2lvbi5zZXQoJ3Rlc3QnLCAnVGVzdCBWYWx1ZScpO1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldChwcm9wLCB2YWx1ZSkge1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdID0gdmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT2J0YWlucyBhIHZhbHVlIGZyb20gdGhlIHNlc3Npb24gb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUgdG8gb2J0YWluLlxuICAgICAqXG4gICAgICogQHJldHVybnMge01peGVkfSBUaGUgcHJvcGVydHkncyB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gJ1Rlc3QgVmFsdWUnXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0KHByb3ApIHtcbiAgICAgIHJldHVybiAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBhIHByb3BlcnR5IGZyb20gdGhlIHNlc3Npb24gb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5kZWwoJ3Rlc3QnKTtcbiAgICAgKiBuZ1Nlc3Npb24uZ2V0KCd0ZXN0Jyk7IC8vID0+IG51bGxcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWwocHJvcCkge1xuICAgICAgZGVsZXRlICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKiBTZXNzaW9uIHNlcnZpY2UgZGVmaW5pdGlvbiAqL1xuICAgIHZhciBuZ1Nlc3Npb25TZXJ2aWNlRGVmID0ge1xuICAgICAgaGFzUm9sZTogaGFzUm9sZSxcbiAgICAgIHNpZ25PdXQ6IHNpZ25PdXQsXG4gICAgICBzaWduSW46IHNpZ25JbixcbiAgICAgIHJlbG9hZDogcmVsb2FkLFxuICAgICAgdXBkYXRlOiB1cGRhdGUsXG4gICAgICB1c2VyOiB1c2VyLFxuICAgICAgZ2V0OiBnZXQsXG4gICAgICBzZXQ6IHNldCxcbiAgICAgIGRlbDogZGVsXG4gICAgfTtcblxuICAgIHJldHVybiBuZ1Nlc3Npb25TZXJ2aWNlRGVmO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlc3Npb24gcmVzb2x2ZSBjYWxsYmFjayBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIHNlc3Npb25SZXNvbHZlRm4oJHNlc3Npb24pIHtcbiAgICBpZiAodXBkYXRlZEF0KSB7XG4gICAgICBpZiAobmcuaXNCb29sZWFuKGRlZmF1bHRzLmNhY2hlKSB8fCBkZWZhdWx0cy5jYWNoZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzTnVtYmVyKGRlZmF1bHRzLmNhY2hlKSB8fCB1cGRhdGVkQXQudmFsdWVPZigpICsgZGVmYXVsdHMuY2FjaGUgPCBEYXRlLm5vdygpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAkc2Vzc2lvbi51cGRhdGUoKTtcbiAgfVxuXG4gIC8qIFNlc3Npb24gcmVzb2x2ZSBkZWZpbml0aW9uICovXG4gIHZhciBzZXNzaW9uUmVzb2x2ZURlZiA9IFsnbmdTZXNzaW9uJywgc2Vzc2lvblJlc29sdmVGbl07XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBydW4gZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBuZ1Nlc3Npb25SdW5Gbigkcm91dGUpIHtcbiAgICBmb3IgKHZhciBwYXRoIGluICRyb3V0ZS5yb3V0ZXMpIHtcbiAgICAgIHZhciByb3V0ZSA9ICRyb3V0ZS5yb3V0ZXNbcGF0aF07XG5cbiAgICAgIGlmICghbmcuaXNPYmplY3Qocm91dGUucmVzb2x2ZSkpIHtcbiAgICAgICAgcm91dGUucmVzb2x2ZSA9IHt9O1xuICAgICAgfVxuXG4gICAgICByb3V0ZS5yZXNvbHZlLl9zZXNzaW9uID0gc2Vzc2lvblJlc29sdmVEZWY7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtb2R1bGUgbmdTZXNzaW9uUHJvdmlkZXJcbiAgICogQGRlc2NyaXB0aW9uIG5nU2Vzc2lvbiBQcm92aWRlclxuICAgKi9cblxuICAvKipcbiAgICogQ29uZmlndXJhdGlvbiBtZXRob2QuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLnVwZGF0ZVVybCBUaGUgc2Vzc2lvbiB1cGRhdGUgVVJMIChHRVR8UFVUKS5cbiAgICogQHBhcmFtIHtPYmplY3R9IGNmZy5zaWduSW5VcmwgVGhlIHNlc3Npb24gc2lnbiBpbiBVUkwgKFBPU1QpLlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLnNpZ25PdXRVcmwgVGhlIHNlc3Npb24gc2lnbiBvdXQgVVJMIChQT1NUKS5cbiAgICogQHBhcmFtIHtOdW1iZXJ8Qm9vbGVhbn0gY2ZnLmNhY2hlIFRoZSBzZXNzaW9uIGNhY2hlIGJlaGF2aW9yLiBOdW1iZXIgaXMgdGhlIG1pbGxpc2Vjb25kcyB0byBjYWNoZSB0aGUgc2Vzc2lvbiBmb3IuXG4gICAqIEEgYm9vbGVhbiBcInRydWVcIiB3aWxsIGNhY2hlIHRoZSBzZXNzaW9uIGZvcmV2ZXIuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIG5nU2Vzc2lvblByb3ZpZGVyLmNvbmZpZ3VyZSh7XG4gICAqICAgc2lnbk91dFVybDogJy9hcGkvdXNlcnMvc2lnbi1vdXQnLFxuICAgKiAgIHNpZ25JblVybDogJy9hcGkvdXNlcnMvc2lnbi1pbicsXG4gICAqICAgdXBkYXRlVXJsOiAnL2FwaS9zZXNzaW9uJyxcbiAgICogICBjYWNoZTogJzFoJ1xuICAgKiB9KTtcbiAgICovXG4gIGZ1bmN0aW9uIGNvbmZpZ3VyZShjZmcpIHtcbiAgICAvKiBTZXRzIHNlc3Npb24gdXBkYXRlIEdFVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnVwZGF0ZVVybCkpIHtcbiAgICAgIGRlZmF1bHRzLnVwZGF0ZVVybCA9IGNmZy51cGRhdGVVcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyBzaWduIGluIFBPU1QgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy5zaWduSW5VcmwpKSB7XG4gICAgICBkZWZhdWx0cy5zaWduSW5VcmwgPSBjZmcuc2lnbkluVXJsO1xuICAgIH1cblxuICAgIC8qIFNldHMgc2lnbiBvdXQgUE9TVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnNpZ25PdXRVcmwpKSB7XG4gICAgICBkZWZhdWx0cy5zaWduT3V0VXJsID0gY2ZnLnNpZ25PdXRVcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyB0aGUgY2FjaGUgYmVoYXZpb3IgKi9cbiAgICBpZiAobmcuaXNOdW1iZXIoY2ZnLmNhY2hlKSB8fCBuZy5pc0Jvb2xlYW4oY2ZnLmNhY2hlKSkge1xuICAgICAgZGVmYXVsdHMuY2FjaGUgPSBjZmcuY2FjaGU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBwcm92aWRlciBkZWZpbml0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdmFyIG5nU2Vzc2lvblByb3ZpZGVyRGVmID0ge1xuICAgIGNvbmZpZ3VyZTogY29uZmlndXJlLFxuXG4gICAgJGdldDogWyckcm9vdFNjb3BlJywgJyRodHRwJywgJyRxJywgbmdTZXNzaW9uU2VydmljZUZuXVxuICB9O1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcHJvdmlkZXIgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBuZ1Nlc3Npb25Qcm92aWRlckZuKCkge1xuICAgIHJldHVybiBuZ1Nlc3Npb25Qcm92aWRlckRlZjtcbiAgfVxuXG4gIC8qIERlZmluZSBBbmd1bGFySlMgbW9kdWxlICovXG4gIG5nLm1vZHVsZSgnbmdTZXNzaW9uJywgW10pXG5cbiAgICAvKiBEZWZpbmUgc2VydmljZSBwcm92aWRlciAqL1xuICAgIC5wcm92aWRlcignbmdTZXNzaW9uJywgbmdTZXNzaW9uUHJvdmlkZXJGbilcblxuICAgIC8qIERlZmluZSBBbmd1bGFySlMgbW9kdWxlIHJ1biBmdW5jdGlvbiAqL1xuICAgIC5ydW4oWyckcm91dGUnLCBuZ1Nlc3Npb25SdW5Gbl0pO1xufSkod2luZG93KTtcbiJdfQ==
