!function(n){"use strict";function e(n,e,r){function s(e,r){n.session.user=r.data,e.resolve(r)}function t(n){return g(null,n)}function i(e,r){n.session.user=null,e.resolve(r)}function l(s,i){var u=r.defer();return n.session.user=null,e.post(o.signInUrl,s,i).then(t.bind(null,u)).catch(u.reject),u.promise}function c(n,s){var t=r.defer();return e.post(o.signOutUrl,n,s).then(i.bind(null,t)).catch(t.reject),t.promise}function a(n,s,t){return t||(t=r.defer()),e.put(o.updateUrl,n,s||{}).then(g.bind(null,s,t)).catch(t.reject),t.promise}function g(n,t){return t||(t=r.defer()),e.get(o.updateUrl,n||{}).then(s.bind(null,t)).catch(t.reject),t.promise}function f(e){var r=n.session;return r?e&&r.user?r.user[e]:r.user:null}function d(n,e){var r=f("roles"),s=0;if(!r||!r.length)return!1;u.isString(r)&&(r=[r]),u.isString(n)&&(n=[n]);for(var t=0,i=n.length;t<i;t++)r.indexOf(n[t])>-1&&s++;return e?s===n.length:!!s}function p(e,r){n.session[e]=r}function U(e){return n.session[e]}function v(e){delete n.session[e]}n.session={};var h={hasRole:d,signOut:c,signIn:l,reload:a,update:g,user:f,get:U,set:p,del:v};return h}function r(n){return n.update({cache:!0})}function s(n){for(var e in n.routes){var r=n.routes[e];u.isObject(r.resolve)||(r.resolve={}),r.resolve.ngSession=l}}function t(n){u.isString(n.updateUrl)&&(o.updateUrl=n.updateUrl),u.isString(n.signInUrl)&&(o.signInUrl=n.signInUrl),u.isString(n.signOutUrl)&&(o.signOutUrl=n.signOutUrl)}function i(){return c}var u=n.angular,o={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/api/session"},l=["ngSession",r],c={configure:t,$get:["$rootScope","$http","$q",e]};u.module("ngSession",[]).provider("ngSession",i).run(["$route",s])}(window);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwibmdTZXNzaW9uU2VydmljZUZuIiwiJHJvb3RTY29wZSIsIiRodHRwIiwiJHEiLCJvblNlc3Npb25VcGRhdGVTdWNjZXNzIiwiZGVmZXJyZWQiLCJyZXMiLCJzZXNzaW9uIiwidXNlciIsImRhdGEiLCJyZXNvbHZlIiwib25TaW5nSW5TdWNjZXNzIiwidXBkYXRlIiwib25TaW5nT3V0U3VjY2VzcyIsInNpZ25JbiIsIm9wdGlvbnMiLCJkZWZlciIsInBvc3QiLCJjb25maWciLCJzaWduSW5VcmwiLCJ0aGVuIiwiYmluZCIsImNhdGNoIiwicmVqZWN0IiwicHJvbWlzZSIsInNpZ25PdXQiLCJzaWduT3V0VXJsIiwicmVsb2FkIiwicHV0IiwidXBkYXRlVXJsIiwiZ2V0IiwicHJvcCIsImhhc1JvbGUiLCJyb2xlcyIsImFsbCIsImFjdHVhbCIsIm1hdGNoZXMiLCJsZW5ndGgiLCJuZyIsImlzU3RyaW5nIiwiaSIsImwiLCJpbmRleE9mIiwic2V0IiwidmFsdWUiLCJkZWwiLCJuZ1Nlc3Npb25TZXJ2aWNlRGVmIiwic2Vzc2lvblJlc29sdmVGbiIsIiRzZXNzaW9uIiwiY2FjaGUiLCJuZ1Nlc3Npb25SdW5GbiIsIiRyb3V0ZSIsInBhdGgiLCJyb3V0ZXMiLCJyb3V0ZSIsImlzT2JqZWN0IiwibmdTZXNzaW9uIiwic2Vzc2lvblJlc29sdmVEZWYiLCJjb25maWd1cmUiLCJjZmciLCJuZ1Nlc3Npb25Qcm92aWRlckZuIiwibmdTZXNzaW9uUHJvdmlkZXJEZWYiLCJhbmd1bGFyIiwiJGdldCIsIm1vZHVsZSIsInByb3ZpZGVyIiwicnVuIl0sIm1hcHBpbmdzIjoiQ0FTQyxTQUFVQSxHQUNULFlBZ0JBLFNBQVNDLEdBQW1CQyxFQUFZQyxFQUFPQyxHQWE3QyxRQUFTQyxHQUF1QkMsRUFBVUMsR0FDeENMLEVBQVdNLFFBQVFDLEtBQU9GLEVBQUlHLEtBRTlCSixFQUFTSyxRQUFRSixHQVFuQixRQUFTSyxH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QyxjQUNsQlIsRUFBT1EsV0FBYWlDLEVBQUlqQyxZQXdCNUIsUUFBU2tDLEtBQ1AsTUFBT0MsR0F2WFQsR0FBSXZCLEdBQUt2QyxFQUFPK0QsUUFHWjVDLEdBQ0ZRLFdBQVksc0JBQ1pQLFVBQVcscUJBQ1hVLFVBQVcsZ0JBbVNUNEIsR0FDRixZQUVBVixHQTJERWMsR0FDRkgsVUFBV0EsRUFFWEssTUFDRSxhQUFjLFFBQVMsS0FFdkIvRCxHQWNKc0MsR0FBRzBCLE9BQU8sZ0JBR1RDLFNBQVMsWUFBYUwsR0FHdEJNLEtBQUssU0FBVWhCLEtBRWhCbkQiLCJmaWxlIjoibmctc2Vzc2lvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogbmdTZXNzaW9uXG4gKlxuICogQGRlc2NyaXB0aW9uIFNlc3Npb24gaGFuZGxlciBtb2R1bGUgZm9yIEFuZ3VsYXJKUy5cbiAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gKiBAYXV0aG9yIEZpbmFsIERldmVsb3BtZW50IFN0dWRpb1xuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3cpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBuZyA9IHdpbmRvdy5hbmd1bGFyO1xuXG4gIC8qIERlZmF1bHQgY29uZmlndXJhdGlvbiAqL1xuICB2YXIgY29uZmlnID0ge1xuICAgIHNpZ25PdXRVcmw6ICcvYXBpL3VzZXJzL3NpZ24tb3V0JyxcbiAgICBzaWduSW5Vcmw6ICcvYXBpL3VzZXJzL3NpZ24taW4nLFxuICAgIHVwZGF0ZVVybDogJy9hcGkvc2Vzc2lvbidcbiAgfTtcblxuICAvKipcbiAgICogbmdTZXNzaW9uIHNlcnZpY2UgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBuZ1Nlc3Npb25TZXJ2aWNlRm4oJHJvb3RTY29wZSwgJGh0dHAsICRxKSB7XG4gICAgJHJvb3RTY29wZS5zZXNzaW9uID0ge307XG5cbiAgICAvKipcbiAgICAgKiBAbW9kdWxlIG5nU2Vzc2lvblxuICAgICAqIEBkZXNjcmlwdGlvbiBuZ1Nlc3Npb24gU2VydmljZVxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogU2Vzc2lvbiB1cGRhdGUgc3VjY2Vzc2Z1bC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TZXNzaW9uVXBkYXRlU3VjY2VzcyhkZWZlcnJlZCwgcmVzKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IHJlcy5kYXRhO1xuXG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT24gU2lnbiBJbiBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNpbmdJblN1Y2Nlc3MoZGVmZXJyZWQpIHtcbiAgICAgIHJldHVybiB1cGRhdGUobnVsbCwgZGVmZXJyZWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9uIFNpZ24gT3V0IHN1Y2Nlc3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2luZ091dFN1Y2Nlc3MoZGVmZXJyZWQsIHJlcykge1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uLnVzZXIgPSBudWxsO1xuXG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2lnbnMgYSB1c2VyIGluLlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgYFBPU1RgIHRvIHRoZSBgY29uZmlnLnNpZ25PdXRVcmxgIHBhdGggYW5kIHBlcmZvcm0gYW5cbiAgICAgKiBgdXBkYXRlYCBpZiBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBpbi5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IG9wdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnNpZ25Jbigkc2NvcGUuZGF0YSlcbiAgICAgKiAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNpZ25JbihkYXRhLCBvcHRpb25zKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAvKiBSZW1vdmUgcHJldmlvdXMgdXNlciBvYmplY3QgKi9cbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gbnVsbDtcblxuICAgICAgJGh0dHAucG9zdChjb25maWcuc2lnbkluVXJsLCBkYXRhLCBvcHRpb25zKVxuICAgICAgICAudGhlbihvblNpbmdJblN1Y2Nlc3MuYmluZChudWxsLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgb3V0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgUE9TVCB0byB0aGUgYGNvbmZpZy5zaWduT3V0VXJsYCBwYXRoIGFuZCBkZWxldGUgdGhlXG4gICAgICogdXNlciBvYmplY3Qgb24gc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBvcHRpb25hbCBkYXRhIHRvIHNlbmQgZm9yIHNpZ24gb3V0LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3Qgb3B0aW9ucy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24uc2lnbk91dCgkc2NvcGUuZGF0YSlcbiAgICAgKiAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNpZ25PdXQoZGF0YSwgb3B0aW9ucykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAucG9zdChjb25maWcuc2lnbk91dFVybCwgZGF0YSwgb3B0aW9ucylcbiAgICAgICAgLnRoZW4ob25TaW5nT3V0U3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbG9hZHMgdGhlIHNlc3Npb24gdXNlciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBQVVQgdG8gdGhlIGBjb25maWcudXBkYXRlVXJsYCBwYXRoIGFuZCB0aGVuIGFcbiAgICAgKiBjb25zZWN1ZW50IHNlc3Npb24gYHVwZGF0ZWAuXG4gICAgICpcbiAgICAgKiBUaGUgc2VydmVyIHNob3VsZCBoYW5kbGUgdGhlIE9VdCByZXF1ZXN0IGFzIGEgcmVsb2FkIHJlcXVlc3QgYW5kIGZldGNoXG4gICAgICogdXBkYXRlZCBzZXNzaW9uIGRhdGEuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IG9wdGlvbnMuXG4gICAgICogQHBhcmFtIHtQcm9taXNlfSBkZWZlcnJlZCBPcHRpb25hbCBkZWZlcnJlZCBwcm9taXNlIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24ucmVsb2FkKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVsb2FkKGRhdGEsIG9wdGlvbnMsIGRlZmVycmVkKSB7XG4gICAgICBpZiAoIWRlZmVycmVkKSB7XG4gICAgICAgIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgIH1cblxuICAgICAgLyogUmVsb2FkcyBjdXJyZW50IHNlc3Npb24gKi9cbiAgICAgICRodHRwLnB1dChjb25maWcudXBkYXRlVXJsLCBkYXRhLCBvcHRpb25zIHx8IHt9KVxuICAgICAgICAudGhlbih1cGRhdGUuYmluZChudWxsLCBvcHRpb25zLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBzZXNzaW9uIHVzZXIgb2JqZWN0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgR0VUIHRvIHRoZSBgY29uZmlnLnVwZGF0ZVVybGAgcGF0aCBhbmQgc2V0IHRoZVxuICAgICAqIHNlc3Npb24ncyB1c2VyIG9iamVjdCBvbiBzdWNjZXNzIHdpdGggdGhlIHJlcXVlc3QncyBgcmVzLmRhdGFgLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBvcHRpb25zLlxuICAgICAqIEBwYXJhbSB7UHJvbWlzZX0gZGVmZXJyZWQgT3B0aW9uYWwgZGVmZXJyZWQgcHJvbWlzZSBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnVwZGF0ZSgpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1cGRhdGUob3B0aW9ucywgZGVmZXJyZWQpIHtcbiAgICAgIGlmICghZGVmZXJyZWQpIHtcbiAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgfVxuXG4gICAgICAvKiBSZXRyaWV2ZSBjdXJyZW50IHNlc3Npb24gKi9cbiAgICAgICRodHRwLmdldChjb25maWcudXBkYXRlVXJsLCBvcHRpb25zIHx8IHt9KVxuICAgICAgICAudGhlbihvblNlc3Npb25VcGRhdGVTdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpKVxuICAgICAgICAuY2F0Y2goZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGEgdXNlciBkYXRhIHZhbHVlIGJ5IHByb3BlcnR5IG5hbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byByZXRyaWV2ZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtNaXhlZH0gVGhlIHByb3BlcnR5J3MgdmFsdWUgb3IgdGhlIHVzZXIgb2JqZWN0IGlmIG5vXG4gICAgICogcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIG5nU2Vzc2lvbi51c2VyKCduYW1lJyk7IC8vID0+ICdKb2huIFNtaXRoJ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVzZXIocHJvcCkge1xuICAgICAgdmFyIHNlc3Npb24gPSAkcm9vdFNjb3BlLnNlc3Npb247XG5cbiAgICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3AgJiYgc2Vzc2lvbi51c2VyKSB7XG4gICAgICAgIHJldHVybiBzZXNzaW9uLnVzZXJbcHJvcF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzZXNzaW9uLnVzZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGFueSBvciBhbGwgb2YgdGhlIHByb3ZpZGVkIHJvbGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHsoU3RyaW5nfFN0cmluZ1tdKX0gcm9sZXMgVGhlIHJlcXVpcmVkIHJvbGVzLiBDYW4gYmUgYSBzaW5nbGVcbiAgICAgKiAgIHN0cmluZyBvciBhIHN0cmluZyBhcnJheS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGFsbCBJZiBhbGwgdGhlIHByb3ZpZGVkIHJvbGVzIGFyZSByZXF1aXJlZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlcygnUk9MRS5BRE1JTicpOyAvLyA9PiBmYWxzZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlcygnUk9MRS5VU0VSJyk7IC8vID0+IHRydWVcbiAgICAgKiBuZ1Nlc3Npb24uaGFzUm9sZXMoWydST0xFLkFETUlOJywgJ1JPTEUuVVNFUiddKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlcyhbJ1JPTEUuQURNSU4nLCAnUk9MRS5VU0VSJ10sIHRydWUpOyAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhhc1JvbGUocm9sZXMsIGFsbCkge1xuICAgICAgdmFyIGFjdHVhbCA9IHVzZXIoJ3JvbGVzJyk7XG4gICAgICB2YXIgbWF0Y2hlcyA9IDA7XG5cbiAgICAgIGlmICghYWN0dWFsIHx8ICFhY3R1YWwubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKGFjdHVhbCkpIHtcbiAgICAgICAgYWN0dWFsID0gW2FjdHVhbF07XG4gICAgICB9XG5cbiAgICAgIGlmIChuZy5pc1N0cmluZyhyb2xlcykpIHtcbiAgICAgICAgcm9sZXMgPSBbcm9sZXNdO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJvbGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoYWN0dWFsLmluZGV4T2Yocm9sZXNbaV0pID4gLTEpIHtcbiAgICAgICAgICBtYXRjaGVzKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGFsbCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlcyA9PT0gcm9sZXMubGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gISFtYXRjaGVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgYSB2YWx1ZSBpbiB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBzZXQuXG4gICAgICogQHBhcmFtIHtNaXhlZH0gVGhlIHByb3BlcnR5IHZhbHVlIHRvIHNldC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIG5nU2Vzc2lvbi5zZXQoJ3Rlc3QnLCAnVGVzdCBWYWx1ZScpO1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldChwcm9wLCB2YWx1ZSkge1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdID0gdmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT2J0YWlucyBhIHZhbHVlIGZyb20gdGhlIHNlc3Npb24gb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUgdG8gb2J0YWluLlxuICAgICAqXG4gICAgICogQHJldHVybnMge01peGVkfSBUaGUgcHJvcGVydHkncyB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gJ1Rlc3QgVmFsdWUnXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0KHByb3ApIHtcbiAgICAgIHJldHVybiAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBhIHByb3BlcnR5IGZyb20gdGhlIHNlc3Npb24gb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5kZWwoJ3Rlc3QnKTtcbiAgICAgKiBuZ1Nlc3Npb24uZ2V0KCd0ZXN0Jyk7IC8vID0+IG51bGxcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWwocHJvcCkge1xuICAgICAgZGVsZXRlICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKiBTZXNzaW9uIHNlcnZpY2UgZGVmaW5pdGlvbiAqL1xuICAgIHZhciBuZ1Nlc3Npb25TZXJ2aWNlRGVmID0ge1xuICAgICAgaGFzUm9sZTogaGFzUm9sZSxcbiAgICAgIHNpZ25PdXQ6IHNpZ25PdXQsXG4gICAgICBzaWduSW46IHNpZ25JbixcbiAgICAgIHJlbG9hZDogcmVsb2FkLFxuICAgICAgdXBkYXRlOiB1cGRhdGUsXG4gICAgICB1c2VyOiB1c2VyLFxuICAgICAgZ2V0OiBnZXQsXG4gICAgICBzZXQ6IHNldCxcbiAgICAgIGRlbDogZGVsXG4gICAgfTtcblxuICAgIHJldHVybiBuZ1Nlc3Npb25TZXJ2aWNlRGVmO1xuICB9XG5cbiAgZnVuY3Rpb24gc2Vzc2lvblJlc29sdmVGbigkc2Vzc2lvbikge1xuICAgIHJldHVybiAkc2Vzc2lvbi51cGRhdGUoe1xuICAgICAgY2FjaGU6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIHZhciBzZXNzaW9uUmVzb2x2ZURlZiA9IFtcbiAgICAnbmdTZXNzaW9uJyxcblxuICAgIHNlc3Npb25SZXNvbHZlRm5cbiAgXTtcblxuICAvKipcbiAgICogbmdTZXNzaW9uIHJ1biBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblJ1bkZuKCRyb3V0ZSkge1xuICAgIGZvciAodmFyIHBhdGggaW4gJHJvdXRlLnJvdXRlcykge1xuICAgICAgdmFyIHJvdXRlID0gJHJvdXRlLnJvdXRlc1twYXRoXTtcblxuICAgICAgaWYgKCFuZy5pc09iamVjdChyb3V0ZS5yZXNvbHZlKSkge1xuICAgICAgICByb3V0ZS5yZXNvbHZlID0ge307XG4gICAgICB9XG5cbiAgICAgIHJvdXRlLnJlc29sdmUubmdTZXNzaW9uID0gc2Vzc2lvblJlc29sdmVEZWY7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtb2R1bGUgbmdTZXNzaW9uUHJvdmlkZXJcbiAgICogQGRlc2NyaXB0aW9uIG5nU2Vzc2lvbiBQcm92aWRlclxuICAgKi9cblxuICAvKipcbiAgICogQ29uZmlndXJhdGlvbiBtZXRob2QuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBuZ1Nlc3Npb25Qcm92aWRlci5jb25maWd1cmUoe1xuICAgKiAgIHNpZ25PdXRVcmw6ICcvYXBpL3VzZXJzL3NpZ24tb3V0JyxcbiAgICogICBzaWduSW5Vcmw6ICcvYXBpL3VzZXJzL3NpZ24taW4nLFxuICAgKiAgIHVwZGF0ZVVybDogJy9hcGkvc2Vzc2lvbidcbiAgICogfSk7XG4gICAqL1xuICBmdW5jdGlvbiBjb25maWd1cmUoY2ZnKSB7XG4gICAgLyogU2V0cyBzZXNzaW9uIHVwZGF0ZSBHRVQgVVJMICovXG4gICAgaWYgKG5nLmlzU3RyaW5nKGNmZy51cGRhdGVVcmwpKSB7XG4gICAgICBjb25maWcudXBkYXRlVXJsID0gY2ZnLnVwZGF0ZVVybDtcbiAgICB9XG5cbiAgICAvKiBTZXRzIHNpZ24gaW4gUE9TVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnNpZ25JblVybCkpIHtcbiAgICAgIGNvbmZpZy5zaWduSW5VcmwgPSBjZmcuc2lnbkluVXJsO1xuICAgIH1cblxuICAgIC8qIFNldHMgc2lnbiBvdXQgUE9TVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnNpZ25PdXRVcmwpKSB7XG4gICAgICBjb25maWcuc2lnbk91dFVybCA9IGNmZy5zaWduT3V0VXJsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcHJvdmlkZXIgZGVmaW5pdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHZhciBuZ1Nlc3Npb25Qcm92aWRlckRlZiA9IHtcbiAgICBjb25maWd1cmU6IGNvbmZpZ3VyZSxcblxuICAgICRnZXQ6IFtcbiAgICAgICckcm9vdFNjb3BlJywgJyRodHRwJywgJyRxJyxcblxuICAgICAgbmdTZXNzaW9uU2VydmljZUZuXG4gICAgXVxuICB9O1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gcHJvdmlkZXIgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBuZ1Nlc3Npb25Qcm92aWRlckZuKCkge1xuICAgIHJldHVybiBuZ1Nlc3Npb25Qcm92aWRlckRlZjtcbiAgfVxuXG4gIC8qIERlZmluZSBBbmd1bGFySlMgbW9kdWxlICovXG4gIG5nLm1vZHVsZSgnbmdTZXNzaW9uJywgW10pXG5cbiAgLyogRGVmaW5lIHNlcnZpY2UgcHJvdmlkZXIgKi9cbiAgLnByb3ZpZGVyKCduZ1Nlc3Npb24nLCBuZ1Nlc3Npb25Qcm92aWRlckZuKVxuXG4gIC8qIERlZmluZSBBbmd1bGFySlMgbW9kdWxlIHJ1biBmdW5jdGlvbiAqL1xuICAucnVuKFsnJHJvdXRlJywgbmdTZXNzaW9uUnVuRm5dKTtcblxufSh3aW5kb3cpKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
